<!-- PASO 1: MÃ‰TODO DE PAGO -->
<div *ngIf="pasoActual === 'pago'">
  <h2 mat-dialog-title>Registrar Pago</h2>

  <mat-dialog-content>
    <!-- SelecciÃ³n de MÃ©todo -->
    <div class="metodos-wrapper">
      <mat-button-toggle-group [(ngModel)]="metodoPago">
        <mat-button-toggle value="EFECTIVO">Efectivo</mat-button-toggle>
        <mat-button-toggle value="BILLETERA">Billetera Digital</mat-button-toggle>
        <mat-button-toggle value="TARJETA">Tarjeta</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <!-- EFECTIVO -->
    <div *ngIf="metodoPago === 'EFECTIVO'">
      <mat-form-field appearance="fill">
        <mat-label>Total a Pagar</mat-label>
        <input matInput [value]="data.total | number:'1.2-2'" readonly>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Recibe</mat-label>
        <input matInput type="number" [(ngModel)]="recibe" (input)="calcularVuelto()">
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Vuelto</mat-label>
        <input matInput [value]="vuelto | number:'1.2-2'" readonly>
      </mat-form-field>
    </div>

    <!-- BILLETERA DIGITAL -->
    <div *ngIf="metodoPago === 'BILLETERA'" class="info-box">
      Pago por Yape o Plin. Confirme una vez recibido.
    </div>

    <!-- TARJETA -->
    <div *ngIf="metodoPago === 'TARJETA'" class="info-box">
      Pago con tarjeta (POS Visa/Mastercard).
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button color="warn" (click)="cerrar()">Cancelar</button>
    <button mat-flat-button color="primary" (click)="confirmarPago()">Continuar</button>
  </mat-dialog-actions>
</div>

<!-- PASO 2: TIPO DE COMPROBANTE -->
<div *ngIf="pasoActual === 'comprobante'">
  <h2 mat-dialog-title>Seleccionar Comprobante</h2>

  <mat-dialog-content>
    <div class="comprobantes-wrapper">
      <button mat-raised-button class="comprobante-btn" (click)="seleccionarComprobante('BOLETA')">
        <mat-icon>receipt</mat-icon>
        <span>Boleta</span>
        <small>Requiere DNI</small>
      </button>

      <button mat-raised-button class="comprobante-btn" (click)="seleccionarComprobante('FACTURA')">
        <mat-icon>description</mat-icon>
        <span>Factura</span>
        <small>Requiere RUC</small>
      </button>

      <button mat-raised-button class="comprobante-btn nota-btn" (click)="seleccionarComprobante('NOTA')">
        <mat-icon>note</mat-icon>
        <span>Nota Simple</span>
        <small>Sin documento</small>
      </button>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="volverAPago()">Volver</button>
  </mat-dialog-actions>
</div>

<!-- PASO 3: DOCUMENTO -->
<div *ngIf="pasoActual === 'documento'">
  <h2 mat-dialog-title>Documento del Cliente</h2>

  <mat-dialog-content>
    <div class="documento-container">
      <mat-form-field appearance="outline" class="tipo-doc-field">
        <mat-label>Tipo de documento</mat-label>
        <mat-select [(ngModel)]="tipoDocumento" [disabled]="true">
          <mat-option value="DNI">DNI</mat-option>
          <mat-option value="RUC">RUC</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="numero-doc-field">
        <mat-label>NÃºmero de {{ tipoDocumento }}</mat-label>
        <input
          matInput
          [(ngModel)]="numeroDocumento"
          [maxlength]="tipoDocumento === 'DNI' ? 8 : 11"
          autocomplete="off"
          inputmode="numeric"
          (input)="soloNumeros($event)"
          [disabled]="cargando"
        />
        <mat-icon matSuffix>badge</mat-icon>
      </mat-form-field>

      <div class="info-comprobante">
        <mat-icon>info</mat-icon>
        <span>Generando {{ tipoComprobante }} para {{ tipoDocumento }}</span>
      </div>

      <!-- ðŸ”¹ Indicador de carga -->
      <div *ngIf="cargando" class="loading-container">
        <mat-spinner diameter="30"></mat-spinner>
        <span>Buscando y registrando cliente...</span>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="volverAComprobante()" [disabled]="cargando">Volver</button>
    <button mat-flat-button color="primary" (click)="confirmarDocumento()" [disabled]="cargando">
      <span *ngIf="!cargando">Generar {{ tipoComprobante }}</span>
      <span *ngIf="cargando">Procesando...</span>
    </button>
  </mat-dialog-actions>
</div>