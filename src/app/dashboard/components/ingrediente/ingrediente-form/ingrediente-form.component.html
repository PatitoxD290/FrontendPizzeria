<h2 mat-dialog-title>
  {{ ingrediente.ID_Insumo ? 'Editar Ingrediente' : 'Nuevo Ingrediente' }}
</h2>

<mat-dialog-content>
  <form #form="ngForm" (ngSubmit)="saveIngrediente()" class="form-container">

    <!-- Secci칩n de datos b치sicos del insumo -->
    <div class="form-section">
      <h3>Datos del Insumo</h3>
      
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Nombre del Ingrediente</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="ingrediente.Nombre"
          name="nombre"
          required
          maxlength="100"
        />
        <mat-error>El nombre es obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Descripci칩n (Opcional)</mat-label>
        <textarea
          matInput
          [(ngModel)]="ingrediente.Descripcion"
          name="descripcion"
          rows="2"
          maxlength="255"
        ></textarea>
      </mat-form-field>

      <div class="row">
        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Unidad de Medida</mat-label>
          <mat-select [(ngModel)]="ingrediente.Unidad_Med" name="unidad_med" required>
            <mat-option value="kg">Kilogramos (kg)</mat-option>
            <mat-option value="g">Gramos (g)</mat-option>
            <mat-option value="l">Litros (l)</mat-option>
            <mat-option value="ml">Mililitros (ml)</mat-option>
            <mat-option value="unidad">Unidad (u)</mat-option>
            <mat-option value="paquete">Paquete</mat-option>
            <mat-option value="caja">Caja</mat-option>
          </mat-select>
          <mat-error>La unidad de medida es obligatoria</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Categor칤a</mat-label>
          <mat-select [(ngModel)]="ingrediente.ID_Categoria_I" name="id_categoria_i" required>
            <mat-option value="">Seleccione categor칤a</mat-option>
            <mat-option *ngFor="let cat of categorias" [value]="cat.ID_Categoria_I">
              {{ cat.Nombre }}
            </mat-option>
          </mat-select>
          <mat-error>La categor칤a es obligatoria</mat-error>
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Stock M칤nimo</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="ingrediente.Stock_Min"
            name="stock_min"
            min="0"
            required
          />
          <mat-error>Stock m칤nimo es obligatorio</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Stock M치ximo</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="ingrediente.Stock_Max"
            name="stock_max"
            min="1"
            required
          />
          <mat-error>Stock m치ximo es obligatorio</mat-error>
        </mat-form-field>
      </div>

      <!-- 游댃 ELIMINADO: Campo de Estado - El backend lo maneja autom치ticamente -->
    </div>

    <!-- Secci칩n de datos adicionales (para crear Y editar) -->
    <div class="form-section">
      <h3>Datos Adicionales</h3>
      
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Proveedor (Opcional)</mat-label>
        <mat-select [(ngModel)]="ingrediente.ID_Proveedor" name="id_proveedor">
          <mat-option value="">Sin proveedor</mat-option>
          <mat-option *ngFor="let prov of proveedores" [value]="prov.ID_Proveedor">
            {{ prov.Nombre }} - {{ prov.Ruc }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="row">
        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Costo Unitario (S/)</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="ingrediente.Costo_Unitario"
            name="costo_unitario"
            min="0"
            step="0.01"
            placeholder="0.00"
          />
          <span matPrefix>S/ &nbsp;</span>
        </mat-form-field>

        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Fecha de Vencimiento (Opcional)</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            [min]="minDate"
            [(ngModel)]="fechaVencimiento"
            (dateChange)="onDateChange()"
            name="fecha_vencimiento"
            placeholder="Seleccione una fecha"
          >
          <mat-datepicker-toggle matSuffix [for]="picker">
            <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
          </mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>

          <button
            mat-icon-button
            matSuffix
            *ngIf="fechaVencimiento"
            (click)="clearFechaVencimiento()"
            type="button"
            aria-label="Clear"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>

  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Cancelar</button>
  <button 
    mat-flat-button 
    color="primary" 
    (click)="saveIngrediente()"
    [disabled]="!ingrediente.Nombre || !ingrediente.Unidad_Med || !ingrediente.ID_Categoria_I">
    {{ ingrediente.ID_Insumo ? 'Actualizar' : 'Guardar' }}
  </button>
</mat-dialog-actions>