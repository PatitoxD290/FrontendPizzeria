<div class="pedido-container">
  
  <!-- Header -->
  <div class="pedido-header">
    <h3>Resumen del Pedido</h3>
    <span class="codigo-badge">{{ codigoPedido }}</span>
  </div>

  <!-- Tabla -->
  <div class="table-wrapper mat-elevation-z1">
    <table mat-table [dataSource]="detalles" class="w-100">

      <!-- Producto / Combo -->
      <ng-container matColumnDef="producto">
        <th mat-header-cell *matHeaderCellDef> Descripción </th>
        <td mat-cell *matCellDef="let d">
          <div class="item-info">
            <div class="item-name">
              <mat-icon *ngIf="esCombo(d)" class="icon-combo">fastfood</mat-icon>
              <mat-icon *ngIf="!esCombo(d)" class="icon-product">restaurant</mat-icon>
              {{ getNombreItem(d) }}
            </div>
            
            <div class="item-meta">
              <span class="badge-tipo" [class.is-combo]="esCombo(d)">
                {{ esCombo(d) ? 'Combo' : d.Tamano_Nombre }}
              </span>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Cantidad -->
      <ng-container matColumnDef="cantidad">
        <th mat-header-cell *matHeaderCellDef class="text-center"> Cant. </th>
        <td mat-cell *matCellDef="let d">
          <div class="qty-control">
            <button mat-icon-button class="small-btn" (click)="reducirCantidad(d)">
              <mat-icon>remove</mat-icon>
            </button>
            <span class="qty-value">{{ d.Cantidad }}</span>
            <button mat-icon-button class="small-btn" (click)="aumentarCantidad(d)">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <!-- Precio Unitario -->
      <ng-container matColumnDef="precio">
        <th mat-header-cell *matHeaderCellDef class="text-right"> P. Unit </th>
        <td mat-cell *matCellDef="let d" class="text-right text-muted">
          S/ {{ (d.PrecioTotal / d.Cantidad) | number:'1.2-2' }}
        </td>
      </ng-container>

      <!-- Subtotal -->
      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef class="text-right"> Subtotal </th>
        <td mat-cell *matCellDef="let d" class="text-right fw-bold">
          S/ {{ d.PrecioTotal | number:'1.2-2' }}
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let d" class="text-right">
          <button mat-icon-button color="warn" (click)="eliminar(d)" matTooltip="Quitar">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      
      <!-- Empty State -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center py-5" colspan="5">
          <div class="empty-cart">
            <mat-icon>shopping_cart_off</mat-icon>
            <p>El carrito está vacío</p>
            <small>Agrega productos para comenzar una venta</small>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <!-- Footer Totales -->
  <div class="pedido-footer mat-elevation-z4">
    <div class="total-row">
      <span class="label">Total a Pagar:</span>
      <span class="value">S/ {{ getTotal() | number:'1.2-2' }}</span>
    </div>
    
    <button mat-flat-button color="primary" class="btn-checkout" 
            (click)="realizarPedido()" 
            [disabled]="detalles.length === 0">
      <mat-icon>point_of_sale</mat-icon>
      PROCESAR PAGO
    </button>
  </div>
</div>