<div class="products-container">
  <!-- Header con título y botón -->
  <div class="products-header">
    <h1 class="page-title">Lista de Combos</h1>
    <button mat-flat-button color="primary" (click)="crearCombo()" class="add-button">
      <mat-icon>add</mat-icon>
      Nuevo Combo
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="terminoBusqueda"
        (keyup.enter)="aplicarFiltros()"
        placeholder="Buscar combos..."
        class="search-input"
      >
      <button mat-icon-button color="primary" (click)="aplicarFiltros()" class="search-button">
        <mat-icon>search</mat-icon>
      </button>
      <button *ngIf="terminoBusqueda || filtroEstado !== 'todos'" mat-icon-button color="warn" (click)="limpiarBusqueda()" class="clear-button">
        <mat-icon>clear</mat-icon>
      </button>
    </div>

    <div class="filter-chips">
      <mat-chip-set>
        <mat-chip 
          [color]="filtroEstado === 'todos' ? 'primary' : 'default'" 
          (click)="filtroEstado = 'todos'; aplicarFiltros()"
          highlighted>
          Todos
        </mat-chip>
        <mat-chip 
          [color]="filtroEstado === 'A' ? 'primary' : 'default'" 
          (click)="filtroEstado = 'A'; aplicarFiltros()"
          highlighted>
          Activos
        </mat-chip>
        <mat-chip 
          [color]="filtroEstado === 'I' ? 'primary' : 'default'" 
          (click)="filtroEstado = 'I'; aplicarFiltros()"
          highlighted>
          Inactivos
        </mat-chip>
      </mat-chip-set>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="spinner-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando combos...</p>
  </div>

  <!-- Stats bar -->
  <div *ngIf="!cargando" class="stats-bar">
    <mat-chip-set>
      <mat-chip color="primary" highlighted>
        <mat-icon>inventory_2</mat-icon>
        Total: {{ combos.length }} combos
      </mat-chip>
      <mat-chip color="accent" highlighted>
        <mat-icon>visibility</mat-icon>
        Mostrando: {{ paginatedCombos.length }} combos
      </mat-chip>
    </mat-chip-set>
  </div>

  <!-- Grid de Cards -->
  <div *ngIf="!cargando && combos.length > 0" class="products-grid">
    <mat-card *ngFor="let combo of paginatedCombos" class="product-card">
      
      <!-- Header con imagen y estado -->
      <div class="card-header">
        <div class="image-container">
          <img 
            [src]="getComboImage(combo.ID_Combo)" 
            [alt]="combo.Nombre"
            class="product-image"
            (error)="onImageError($event)"
          >
          <div class="image-overlay">
            <mat-chip [color]="getEstadoColor(combo.Estado)" class="status-chip">
              {{ getEstadoText(combo.Estado) }}
            </mat-chip>
          </div>
        </div>
      </div>

      <!-- Contenido principal -->
      <mat-card-content class="card-content">
        
        <!-- Información básica -->
        <div class="product-basic-info">
          <h3 class="product-name" [matTooltip]="combo.Nombre" matTooltipPosition="above">
            {{ combo.Nombre }}
          </h3>
          <p class="product-id">ID: {{ combo.ID_Combo }}</p>
        </div>

        <!-- Descripción -->
        <div class="product-description">
          <p class="description-text" [matTooltip]="combo.Descripcion || 'Sin descripción'" matTooltipPosition="above">
            {{ truncateText(combo.Descripcion || 'Sin descripción', 60) }}
          </p>
        </div>

        <!-- Precio -->
        <div class="pricing-section" 
             [matTooltip]="getPrecioInfo(combo)" 
             matTooltipPosition="above">
          <div class="price-info">
            <mat-icon class="price-icon">attach_money</mat-icon>
            <span class="price-text">S/ {{ combo.Precio.toFixed(2) }}</span>
          </div>
        </div>

        <!-- Productos incluidos -->
        <div class="products-section" 
             [matTooltip]="getProductosInfo(combo)" 
             matTooltipPosition="above">
          <div class="products-info">
            <mat-icon class="products-icon">fastfood</mat-icon>
            <span class="products-text">
              {{ getCantidadProductos(combo) }} producto{{ getCantidadProductos(combo) !== 1 ? 's' : '' }}
            </span>
          </div>
        </div>

      </mat-card-content>

      <!-- Acciones -->
      <mat-card-actions class="card-actions">
        <!-- Botón para activar/desactivar -->
        <button 
          *ngIf="combo.Estado === 'I'"
          mat-stroked-button 
          color="primary" 
          (click)="activarCombo(combo)" 
          class="action-button"
          matTooltip="Activar combo"
        >
          <mat-icon>check_circle</mat-icon>
          Activar
        </button>
        
        <button 
          *ngIf="combo.Estado === 'A'"
          mat-stroked-button 
          color="warn" 
          (click)="desactivarCombo(combo)" 
          class="action-button"
          matTooltip="Desactivar combo"
        >
          <mat-icon>cancel</mat-icon>
          Desactivar
        </button>

        <!-- Botón de editar -->
        <button 
          mat-flat-button 
          color="primary" 
          (click)="editarCombo(combo)" 
          class="action-button"
          matTooltip="Editar combo"
        >
          <mat-icon>edit</mat-icon>
          Editar
        </button>
        
        <!-- Botón de eliminar -->
        <button 
          mat-stroked-button 
          color="warn" 
          (click)="eliminarCombo(combo)" 
          class="action-button"
          matTooltip="Eliminar combo"
        >
          <mat-icon>delete</mat-icon>
          Eliminar
        </button>
      </mat-card-actions>

    </mat-card>
  </div>

  <!-- Paginación -->
  <div *ngIf="!cargando && combos.length > 0" class="pagination-container">
    <mat-paginator 
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="currentPage"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="custom-paginator">
    </mat-paginator>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!cargando && combos.length === 0" class="no-data">
    <mat-icon class="no-data-icon">inventory_2</mat-icon>
    <h3>No hay combos registrados</h3>
    <p>Comienza agregando tu primer combo al sistema</p>
    <button mat-flat-button color="primary" (click)="crearCombo()">
      <mat-icon>add</mat-icon>
      Agregar primer combo
    </button>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !cargando" class="error-state">
    <mat-icon class="error-icon">warning</mat-icon>
    <h3>Error al cargar combos</h3>
    <p>{{ error }}</p>
    <button mat-flat-button color="primary" (click)="cargarCombos()">
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>
</div>