<div class="pago-container">

Â  <!-- ðŸ”„ LOADING OVERLAY -->
Â  <div class="loading-overlay" *ngIf="procesando">
Â  Â  <mat-spinner diameter="60" color="accent"></mat-spinner>
Â  Â  <h3>Procesando su pedido...</h3>
Â  </div>

Â  <!-- âœ… PANTALLA FINAL (Ã‰XITO) -->
Â  <div class="pantalla-final" *ngIf="pasoActual === Pasos.FINAL">
Â  Â  <div class="success-content">
Â  Â  Â  <mat-icon class="icon-success">check_circle</mat-icon>
Â  Â  Â  <h1>Â¡Pedido Confirmado!</h1>
Â  Â  Â 
Â  Â  Â  <div class="ticket-visual">
Â  Â  Â  Â  <p class="label">TU NÃšMERO DE PEDIDO</p>
Â  Â  Â  Â  <p class="code">{{ codigoPedidoGenerado }}</p>
Â  Â  Â  </div>

Â  Â  Â  <p class="instruction">Por favor, recoge tu comprobante y espera tu llamado.</p>
Â  Â  Â 
Â  Â  Â  <button mat-flat-button color="primary" class="btn-inicio" (click)="volverInicio()">
Â  Â  Â  Â  <mat-icon>home</mat-icon> Volver al Inicio
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

Â  <!-- 1ï¸âƒ£ PASO 1: SELECCIÃ“N DE PAGO -->
Â  <div class="paso-content" *ngIf="pasoActual === Pasos.PAGO && !selectedMetodoPago">
Â  Â  <h2 class="titulo-paso">Â¿CÃ³mo deseas pagar?</h2>
Â  Â  <h3 class="monto-total">Total: S/ {{ total | number:'1.2-2' }}</h3>

Â  Â  <div class="metodos-grid">
Â  Â  Â  <button mat-raised-button class="metodo-btn" (click)="seleccionarMetodo(TIPO_PAGO.EFECTIVO)">
Â  Â  Â  Â  <mat-icon class="icon-grande">payments</mat-icon>
Â  Â  Â  Â  <span>Efectivo</span>
Â  Â  Â  </button>
Â  Â  Â 
Â  Â  Â  <button mat-raised-button class="metodo-btn" (click)="seleccionarMetodo(TIPO_PAGO.TARJETA)">
Â  Â  Â  Â  <mat-icon class="icon-grande">credit_card</mat-icon>
Â  Â  Â  Â  <span>Tarjeta</span>
Â  Â  Â  </button>
Â  Â  Â 
Â  Â  Â  <button mat-raised-button class="metodo-btn" (click)="seleccionarMetodo(TIPO_PAGO.BILLETERA)">
Â  Â  Â  Â  <mat-icon class="icon-grande">qr_code_2</mat-icon>
Â  Â  Â  Â  <span>Yape / Plin</span>
Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <button mat-stroked-button color="warn" class="btn-volver" routerLink="/kiosko/carrito">
Â  Â  Â  <mat-icon>arrow_back</mat-icon> Volver al Carrito
Â  Â  </button>
Â  </div>

Â  <!-- 1.1 PAGO EN EFECTIVO (Calculadora) -->
Â  <div class="paso-content" *ngIf="pasoActual === Pasos.PAGO && selectedMetodoPago === TIPO_PAGO.EFECTIVO">
Â  Â  <h2 class="titulo-paso">Pago en Efectivo</h2>
Â  Â 
Â  Â  <div class="display-pago">
Â  Â  Â  <div class="info-row">
Â  Â  Â  Â  <span>Total a Pagar:</span>
Â  Â  Â  Â  <strong>S/ {{ total | number:'1.2-2' }}</strong>
Â  Â  Â  </div>
Â  Â  Â  <div class="info-row big">
Â  Â  Â  Â  <span>Recibido:</span>
Â  Â  Â  Â  <span class="input-simulado">S/ {{ recibeString || '0.00' | number:'1.2-2' }}</span>
Â  Â  Â  </div>
Â  Â  Â  <div class="info-row highlight">
Â  Â  Â  Â  <span>Vuelto:</span>
Â  Â  Â  Â  <span>S/ {{ vuelto | number:'1.2-2' }}</span>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="numpad">
Â  Â  Â  <button *ngFor="let n of [1,2,3,4,5,6,7,8,9]" (click)="addNumber(n.toString())">{{ n }}</button>
Â  Â  Â  <button (click)="addDecimal()">.</button>
Â  Â  Â  <button (click)="addNumber('0')">0</button>
Â  Â  Â  <button (click)="deleteLast()" class="btn-del"><mat-icon>backspace</mat-icon></button>
Â  Â  </div>

Â  Â  <div class="actions">
Â  Â  Â  <button mat-button color="warn" (click)="selectedMetodoPago = null">Cancelar</button>
Â  Â  Â  <button mat-flat-button color="primary" class="btn-next"
Â  Â  Â  Â  Â  Â  Â  (click)="confirmarPagoEfectivo()"
Â  Â  Â  Â  Â  Â  Â  [disabled]="montoRecibido < total">
Â  Â  Â  Â  Continuar <mat-icon>arrow_forward</mat-icon>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

Â  <!-- 1.2 VERIFICACIÃ“N CÃ“DIGO (Simulado para Tarjeta/Yape) -->
Â  <div class="paso-content" *ngIf="solicitandoCodigo">
Â  Â  <h2 class="titulo-paso">Procesando Pago</h2>
Â  Â  <p class="text-center">Sigue las instrucciones en el POS o tu celular.</p>
Â  Â 
Â  Â  <div class="simulacion-box">
Â  Â  Â  <mat-spinner diameter="40" color="primary"></mat-spinner>
Â  Â  Â  <p>Esperando confirmaciÃ³n...</p>
Â  Â  Â  <button mat-stroked-button (click)="verificarCodigoSimulado()">Simular Pago Exitoso</button>
Â  Â  </div>

Â  Â  <button mat-button color="warn" (click)="cancelarVerificacion()">Cancelar OperaciÃ³n</button>
Â  </div>

Â  <!-- 2ï¸âƒ£ PASO 2: COMPROBANTE -->
Â  <div class="paso-content" *ngIf="pasoActual === Pasos.COMPROBANTE">
Â  Â  <h2 class="titulo-paso">Selecciona Comprobante</h2>

Â  Â  <div class="comprobantes-grid">
Â  Â  Â  <button mat-raised-button class="comp-btn" (click)="seleccionarComprobante(TIPO_VENTA.NOTA)">
Â  Â  Â  Â  <mat-icon>receipt_long</mat-icon>
Â  Â  Â  Â  <span>Sin Comprobante</span>
Â  Â  Â  Â  <small>(Nota de Venta)</small>
Â  Â  Â  </button>
Â  Â  Â 
Â  Â  Â  <button mat-raised-button class="comp-btn" (click)="seleccionarComprobante(TIPO_VENTA.BOLETA)">
Â  Â  Â  Â  <mat-icon>description</mat-icon>
Â  Â  Â  Â  <span>Boleta</span>
Â  Â  Â  Â  <small>DNI</small>
Â  Â  Â  </button>
Â  Â  Â 
Â  Â  Â  <button mat-raised-button class="comp-btn" (click)="seleccionarComprobante(TIPO_VENTA.FACTURA)">
Â  Â  Â  Â  <mat-icon>business</mat-icon>
Â  Â  Â  Â  <span>Factura</span>
Â  Â  Â  Â  <small>RUC</small>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

Â  <!-- 3ï¸âƒ£ PASO 3: DOCUMENTO -->
Â  <div class="paso-content" *ngIf="pasoActual === Pasos.DOCUMENTO">
Â  Â  <h2 class="titulo-paso">Ingrese {{ tipoDocumento }}</h2>
Â  Â 
Â  Â  <div class="display-pago">
Â  Â  Â  <span class="input-simulado">{{ numeroDocumento || 'Ingrese nÃºmero' }}</span>
Â  Â  </div>

Â  Â  <div class="numpad">
Â  Â  Â  <button *ngFor="let n of [1,2,3,4,5,6,7,8,9]" (click)="addDocNumber(n.toString())">{{ n }}</button>
Â  Â  Â  <button disabled></button>
Â  Â  Â  <button (click)="addDocNumber('0')">0</button>
Â  Â  Â  <button (click)="deleteDocLast()" class="btn-del"><mat-icon>backspace</mat-icon></button>
Â  Â  </div>

Â  Â  <div class="actions">
Â  Â  Â  <button mat-button (click)="volverAComprobante()">AtrÃ¡s</button>
Â  Â  Â  <button mat-flat-button color="primary" class="btn-next"
Â  Â  Â  Â  Â  Â  Â  (click)="confirmarDocumento()"
Â  Â  Â  Â  Â  Â  Â  [disabled]="numeroDocumento.length < 8">
Â  Â  Â  Â  Confirmar
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

</div>