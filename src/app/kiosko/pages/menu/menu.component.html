<div class="kiosko-container">
  
  <!-- ðŸ” Barra Superior -->
  <div class="search-header">
    <div class="search-box mat-elevation-z2">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        placeholder="Â¿QuÃ© se te antoja hoy?" 
        [(ngModel)]="terminoBusqueda" 
        (keyup)="aplicarFiltros()">
      <button *ngIf="terminoBusqueda" mat-icon-button (click)="limpiarBusqueda()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- ðŸ·ï¸ CategorÃ­as (Horizontal Scroll) -->
  <div class="categories-bar">
    <mat-chip-listbox>
      <mat-chip-option 
        [selected]="categoriaSeleccionada === null" 
        (click)="filtrarPorCategoria(null)"
        color="accent">
        Todo
      </mat-chip-option>
      
      <mat-chip-option 
        [selected]="categoriaSeleccionada === 999" 
        (click)="filtrarPorCategoria(999)"
        color="warn">
        ðŸ”¥ Combos
      </mat-chip-option>

      <mat-chip-option 
        *ngFor="let cat of categorias" 
        [selected]="categoriaSeleccionada === cat.ID_Categoria_P"
        (click)="filtrarPorCategoria(cat.ID_Categoria_P)"
        color="primary">
        {{ cat.Nombre }}
      </mat-chip-option>
    </mat-chip-listbox>
  </div>

  <!-- ðŸŒ€ Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="60" color="accent"></mat-spinner>
    <p>Preparando el menÃº...</p>
  </div>

  <!-- ðŸ“¦ Grid de Productos -->
  <div *ngIf="!loading" class="menu-content" id="menu-grid">
    
    <div class="products-grid">
      <mat-card *ngFor="let item of paginatedItems" 
                class="menu-card" 
                (click)="abrirDetalle(item)">
        
        <!-- Imagen -->
        <div class="card-image">
          <!-- ðŸ–¼ï¸ AquÃ­ se aplica la imagen cargada dinÃ¡micamente -->
          <img [src]="item.imagen" [alt]="item.nombre" (error)="onImageError($event)">
          
          <!-- Badge Combo -->
          <div class="combo-badge" *ngIf="item.tipo === 'combo'">
            <mat-icon>local_offer</mat-icon> COMBO
          </div>

          <!-- Badge Agotado -->
          <div class="agotado-overlay" *ngIf="item.tipo === 'producto' && item.stock === 0">
             <span>AGOTADO</span>
          </div>
          
          <!-- Overlay Click -->
          <div class="card-overlay" *ngIf="item.stock > 0">
            <span>Seleccionar</span>
          </div>
        </div>

        <!-- Contenido -->
        <mat-card-content class="card-content">
          <h3 class="product-title">{{ item.nombre }}</h3>
          <p class="product-desc">{{ item.descripcion }}</p>
          
          <div class="card-footer">
            <span class="price">{{ item.precioDisplay }}</span>
            <button mat-mini-fab color="primary" class="add-btn" [disabled]="item.stock === 0">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="paginatedItems.length === 0" class="no-results">
      <mat-icon>restaurant_menu</mat-icon>
      <h3>No encontramos lo que buscas</h3>
      <button mat-button color="primary" (click)="limpiarBusqueda()">Ver todo el menÃº</button>
    </div>

  </div>

  <!-- ðŸ“„ Paginador -->
  <mat-paginator 
    [length]="filteredItems.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
    [hidden]="filteredItems.length === 0"
    class="custom-paginator">
  </mat-paginator>

</div>