<div class="pago-container">
  <!-- üîÑ LOADING OVERLAY -->
  <div class="loading-overlay" *ngIf="procesando">
    <div class="cargando">
      <div class="loader-circular"></div>
      <h3>Procesando su pedido...</h3>
      <p>Por favor, espere</p>
    </div>
  </div>

  <!-- ‚úÖ PANTALLA FINAL (√âXITO) -->
  <div class="pantalla-final" *ngIf="pasoActual === Pasos.FINAL && !procesando">
    <div class="success-content">
      <mat-icon class="icono-exito">check_circle</mat-icon>
      <h2>¬°Pedido Confirmado!</h2>
     
      <div class="codigo-pedido-grande">
        <span class="codigo-label">TU N√öMERO DE PEDIDO</span>
        <span class="codigo-valor">{{ codigoPedidoGenerado }}</span>
      </div>

      <p class="instruccion-codigo">Por favor, recoge tu comprobante y espera tu llamado.</p>
     
      <button class="boton-inicio" (click)="volverInicio()">
        <mat-icon>home</mat-icon>
        <span>Volver al Inicio</span>
      </button>
    </div>
  </div>

  <!-- 1Ô∏è‚É£ PASO 1: SELECCI√ìN DE PAGO -->
  <div class="paso-content" *ngIf="pasoActual === Pasos.PAGO && !selectedMetodoPago && !procesando">
    <h2>
      <mat-icon class="icono-titulo">payments</mat-icon>
      Pago del Pedido
    </h2>

    <!-- Resumen de pago -->
    <div class="resumen-pago">
      <div class="info-row">
        <p>Total a pagar:</p>
        <h3>S/ {{ total | number:'1.2-2' }}</h3>
      </div>
    </div>

    <!-- OPCIONES PRINCIPALES HORIZONTALES -->
    <div class="opciones-principales">
      <div class="contenedor-botones-horizontal">
        <button mat-raised-button (click)="seleccionarMetodo(TIPO_PAGO.BILLETERA)" 
                class="boton-opcion-horizontal boton-billetera">
          <mat-icon>account_balance_wallet</mat-icon>
          <span>Billetera Digital</span>
        </button>

        <button mat-raised-button (click)="seleccionarMetodo(TIPO_PAGO.TARJETA)" 
                class="boton-opcion-horizontal boton-tarjeta">
          <mat-icon>credit_card</mat-icon>
          <span>Tarjeta Cr√©dito/D√©bito</span>
        </button>
      </div>

      <!-- BOT√ìN VOLVER AL CARRITO -->
      <button mat-raised-button (click)="volverAlCarrito()" class="boton-volver-carrito">
        <mat-icon>arrow_back</mat-icon>
        <span>Volver al Carrito</span>
      </button>
    </div>
  </div>

  <!-- 1.2 VERIFICACI√ìN C√ìDIGO (Simulado para Tarjeta/Yape) -->
  <div class="ventana-separada verificacion-codigo" *ngIf="solicitandoCodigo && !procesando">
    <mat-icon class="icono-verificacion">verified_user</mat-icon>
    <h2>Procesando Pago</h2>
    <p class="instruccion">Sigue las instrucciones en el POS o tu celular.</p>
   
    <div class="simulacion-box">
      <div class="loader-circular" style="width: 50px; height: 50px; margin: 20px auto;"></div>
      <p>Esperando confirmaci√≥n...</p>
      <button class="boton-simular btn-si" (click)="verificarCodigoSimulado()">
        <mat-icon>check_circle</mat-icon>
        <span>Simular Pago Exitoso</span>
      </button>
    </div>

    <button class="btn-no boton-cancelar" (click)="cancelarVerificacion()">
      <mat-icon>cancel</mat-icon>
      <span>Cancelar Operaci√≥n</span>
    </button>
  </div>

  <!-- 2Ô∏è‚É£ PASO 2: COMPROBANTE -->
  <div class="paso-content" *ngIf="pasoActual === Pasos.COMPROBANTE && !procesando">
    <h2>
      <mat-icon class="icono-titulo">receipt</mat-icon>
      Selecciona Comprobante
    </h2>

    <div class="contenedor-boleta-factura">
      <button class="boton-opcion btn-no-documento" (click)="seleccionarComprobante(TIPO_VENTA.NOTA)">
        <mat-icon>description</mat-icon>
        <span>Sin Comprobante</span>
      </button>
     
      <button class="boton-opcion btn-boleta" (click)="seleccionarComprobante(TIPO_VENTA.BOLETA)">
        <mat-icon>receipt_long</mat-icon>
        <span>Boleta (DNI)</span>
      </button>
     
      <button class="boton-opcion btn-factura" (click)="seleccionarComprobante(TIPO_VENTA.FACTURA)">
        <mat-icon>assignment</mat-icon>
        <span>Factura (RUC)</span>
      </button>
    </div>

    <button class="boton-volver" (click)="volverAPago()">
      <mat-icon>arrow_back</mat-icon>
      <span>Volver al Pago</span>
    </button>
  </div>

  <!-- 3Ô∏è‚É£ PASO 3: DOCUMENTO -->
  <div class="ventana-separada" *ngIf="pasoActual === Pasos.DOCUMENTO && !procesando">
    <h2>
      <mat-icon class="icono-titulo">badge</mat-icon>
      Ingrese {{ tipoDocumento }}
    </h2>
   
    <div class="resumen-pago">
      <p class="codigo-valor" style="font-size: 2rem; letter-spacing: 4px;">
        {{ numeroDocumento || '_ _ _ _ _ _ _ _' }}
      </p>
    </div>

    <div class="keypad">
      <div class="key-row">
        <button *ngFor="let n of [1,2,3]" (click)="addDocNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button *ngFor="let n of [4,5,6]" (click)="addDocNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button *ngFor="let n of [7,8,9]" (click)="addDocNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button disabled style="opacity: 0.3;">.</button>
        <button (click)="addDocNumber('0')">0</button>
        <button (click)="deleteDocLast()" class="btn-del">
          <mat-icon>backspace</mat-icon>
        </button>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn-si" (click)="confirmarDocumento()"
              [disabled]="(tipoDocumento === 'DNI' && numeroDocumento.length < 8) || 
                         (tipoDocumento === 'RUC' && numeroDocumento.length < 11)">
        <mat-icon>check_circle</mat-icon>
        <span>Confirmar</span>
      </button>
      <button class="btn-no" (click)="volverAComprobante()">
        <mat-icon>arrow_back</mat-icon>
        <span>Atr√°s</span>
      </button>
    </div>
  </div>
</div>