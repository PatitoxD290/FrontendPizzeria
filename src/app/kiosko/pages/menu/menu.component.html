<div class="menu-container">
  <!-- üîç Barra de B√∫squeda -->
  <div class="search-section">
    <div class="search-box">
      <mat-icon>search</mat-icon>
      <input 
        type="text" 
        placeholder="¬øQu√© desea ordenar hoy?" 
        [(ngModel)]="searchTerm" 
        (keyup)="aplicarFiltros()">
      <button *ngIf="searchTerm" mat-icon-button (click)="searchTerm=''; aplicarFiltros()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- üè∑Ô∏è Categor√≠as -->
  <div class="categorias-container">
    <button mat-raised-button 
            [color]="filtroCategoria === '' ? 'primary' : ''" 
            (click)="filtrarPorCategoria(null)">
      Todos
    </button>

    <button mat-raised-button 
            [color]="filtroCategoria === 'Combos' ? 'primary' : ''" 
            class="combo-category-btn"
            (click)="filtrarPorCategoria(999)">
      Combos
    </button>

    <button *ngFor="let cat of categorias" 
            mat-raised-button 
            [color]="filtroCategoria === cat.Nombre ? 'primary' : ''" 
            (click)="filtrarPorCategoria(cat.ID_Categoria_P)">
      {{ cat.Nombre }}
    </button>
  </div>

  <!-- üåÄ Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- üßæ Lista de productos - AHORA MUESTRA PRODUCTOS CON RANGO DE PRECIOS -->
  <div *ngIf="!loading" class="productos-grid">
    <div
      *ngFor="let p of paginatedItems"
      class="producto-card"
      (click)="abrirPersonalizacion(p)"
      style="cursor: pointer"
    >
      <div class="producto-imagen-container">
        <img
          [src]="p.imagen"
          (error)="onImageError($event)"
          [alt]="p.Nombre"
          class="producto-imagen"
        />
      </div>
      <div class="producto-info">

        <!-- üîπ CONTENEDOR PARA CATEGOR√çA Y BADGES EN LA MISMA L√çNEA -->
        <div class="categoria-badges-container">
          <!-- Categor√≠a a la izquierda -->
          <div class="meta-item categoria-item" *ngIf="!p.esCombo">
            <span class="meta-value">{{ p.nombre_categoria }}</span>
          </div>

          <!-- Badges a la derecha -->
          <div class="badges-right">
            <!-- üîπ Indicador de combo -->
            <div *ngIf="p.esCombo" class="combo-badge meta-badge">
              <img src="/assets/icons/ic-combo.png" alt="Combo" class="badge-icon">
              Combo
            </div>

            <!-- üîπ Indicador de tama√±os disponibles -->
            <div *ngIf="!p.esCombo && p.tamanos && p.tamanos.length > 1" class="tamanos-badge meta-badge">
              <img src="/assets/icons/ic-regla.png" alt="Tama√±os" class="badge-icon">
              {{ p.tamanos.length }} Tama√±os
            </div>
          </div>
        </div>

        <h3 class="producto-nombre">{{ p.Nombre }}</h3>

        <!-- üîπ Mostrar detalles de combo DEBAJO de la descripci√≥n -->
        <div *ngIf="p.esCombo && p.detallesTexto" class="producto-detalles">
          {{ p.detallesTexto }}
        </div>

        <p class="producto-descripcion">{{ p.Descripcion }}</p>

        <!-- üîπ INFORMACI√ìN COMPLETA EN ORDEN VERTICAL -->
        <div class="producto-meta-info">
          <!-- Precio - "Desde" para productos con m√∫ltiples tama√±os -->
          <div class="meta-item precio-item">
            <span class="meta-value precio">
              <span *ngIf="!p.esCombo && (p.tamanos?.length || 0) > 1" class="desde-label"
                >Precio Desde
              </span>
              {{ obtenerRangoPrecios(p) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay resultados -->
  <div *ngIf="!loading && paginatedItems.length === 0" class="no-results">
    <mat-icon>search_off</mat-icon>
    <p>No se encontraron productos o combos</p>
    <button mat-button color="primary" (click)="limpiarBusqueda()">Ver todo el men√∫</button>
  </div>

  <!-- Paginador -->
  <mat-paginator
    [length]="productosFiltrados.length" 
    [pageSize]="pageSize" 
    [pageSizeOptions]="[8, 12, 16, 24]" 
    (page)="onPageChange($event)"
    [hidden]="productosFiltrados.length === 0">
  </mat-paginator>

</div>