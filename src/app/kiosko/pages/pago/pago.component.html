<div class="pago-container">

  <!-- üîÑ LOADING OVERLAY -->
  <div class="loading-overlay" *ngIf="procesando">
    <div class="cargando">
      <div class="loader-circular"></div>
      <h3>Procesando su pedido...</h3>
      <p>Por favor, espere</p>
    </div>
  </div>

  <!-- ‚úÖ PANTALLA FINAL (√âXITO) -->
  <div class="pantalla-final" *ngIf="pasoActual === Pasos.FINAL && !procesando">
    <div class="success-content">
      <img src="assets/images/check-circle.png" alt="√âxito" class="icono-exito">
      <h2>¬°Pedido Confirmado!</h2>
     
      <div class="codigo-pedido-grande">
        <span class="codigo-label">TU N√öMERO DE PEDIDO</span>
        <span class="codigo-valor">{{ codigoPedidoGenerado }}</span>
      </div>

      <p class="instruccion-codigo">Por favor, recoge tu comprobante y espera tu llamado.</p>
     
      <button class="boton-inicio" (click)="volverInicio()">
        <span>üè†</span> Volver al Inicio
      </button>
    </div>
  </div>

  <!-- 1Ô∏è‚É£ PASO 1: SELECCI√ìN DE PAGO -->
  <div class="paso-content" *ngIf="pasoActual === Pasos.PAGO && !selectedMetodoPago && !procesando">
    <h2>
      <img src="assets/images/payment.png" alt="Pago" class="icono-btn">
      ¬øC√≥mo deseas pagar?
    </h2>
    
    <!-- En la secci√≥n de resumen de pago, agrega esto: -->
    <div class="resumen-pago">
      <div class="info-row">
        <p>SubTotal:</p>
        <h4>S/ {{ subtotal | number:'1.2-2' }}</h4>
      </div>
      <div class="info-row">
        <p>Total a pagar:</p>
        <h3>S/ {{ total | number:'1.2-2' }}</h3>
      </div>
    </div>

    
    <div class="contenedor-botones-horizontal">
      <button class="boton-opcion-horizontal" (click)="seleccionarMetodo(TIPO_PAGO.EFECTIVO)">
        <img src="assets/images/efectivo.png" alt="Efectivo">
        <span>Efectivo</span>
      </button>
     
      <button class="boton-opcion-horizontal" (click)="seleccionarMetodo(TIPO_PAGO.TARJETA)">
        <img src="assets/images/tarjeta.png" alt="Tarjeta">
        <span>Tarjeta</span>
      </button>
    </div>

    <div class="contenedor-botones-horizontal">
      <button class="boton-opcion" (click)="seleccionarMetodo(TIPO_PAGO.BILLETERA)">
        <img src="assets/images/yape.png" alt="Yape">
        <span>Yape / Plin</span>
      </button>
    </div>

    <button class="boton-volver" routerLink="/kiosko/carrito">
      <span>‚Üê</span> Volver al Carrito
    </button>
  </div>

  <!-- 1.1 PAGO EN EFECTIVO (Calculadora) -->
  <div class="ventana-separada" *ngIf="pasoActual === Pasos.PAGO && selectedMetodoPago === TIPO_PAGO.EFECTIVO && !procesando">
    <h2>Pago en Efectivo</h2>
   
    <div class="resumen-pago">
      <div class="info-row">
        <p>Total a Pagar:</p>
        <h3>S/ {{ total | number:'1.2-2' }}</h3>
      </div>
      
      <div class="info-row">
        <p>Recibido:</p>
        <h3 style="color: #007bff;">S/ {{ recibeString || '0.00' }}</h3>
      </div>
      
      <div class="info-row">
        <p>Vuelto:</p>
        <h3 style="color: #28a745;">S/ {{ vuelto | number:'1.2-2' }}</h3>
      </div>
    </div>

    <div class="keypad">
      <div class="key-row">
        <button *ngFor="let n of [1,2,3]" (click)="addNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button *ngFor="let n of [4,5,6]" (click)="addNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button *ngFor="let n of [7,8,9]" (click)="addNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button (click)="addDecimal()">.</button>
        <button (click)="addNumber('0')">0</button>
        <button (click)="deleteLast()" class="btn-del">‚å´</button>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn-si" (click)="confirmarPagoEfectivo()" [disabled]="montoRecibido < total">
        Continuar ‚Üí
      </button>
      <button class="btn-no" (click)="selectedMetodoPago = null">
        Cancelar
      </button>
    </div>
  </div>

  <!-- 1.2 VERIFICACI√ìN C√ìDIGO (Simulado para Tarjeta/Yape) -->
  <div class="ventana-separada verificacion-codigo" *ngIf="solicitandoCodigo && !procesando">
    <img src="assets/images/verificacion.png" alt="Verificaci√≥n" class="icono-verificacion">
    <h2>Procesando Pago</h2>
    <p class="instruccion">Sigue las instrucciones en el POS o tu celular.</p>
   
    <div class="simulacion-box">
      <div class="loader-circular" style="width: 50px; height: 50px; margin: 20px auto;"></div>
      <p>Esperando confirmaci√≥n...</p>
      <button class="boton-simular btn-si" (click)="verificarCodigoSimulado()">
        Simular Pago Exitoso
      </button>
    </div>

    <button class="btn-no boton-cancelar" (click)="cancelarVerificacion()">
      Cancelar Operaci√≥n
    </button>
  </div>

  <!-- 2Ô∏è‚É£ PASO 2: COMPROBANTE -->
  <div class="paso-content" *ngIf="pasoActual === Pasos.COMPROBANTE && !procesando">
    <h2>
      <img src="assets/images/documento.png" alt="Documento" class="icono-btn">
      Selecciona Comprobante
    </h2>

    <div class="contenedor-boleta-factura">
      <button class="boton-opcion btn-no-documento" (click)="seleccionarComprobante(TIPO_VENTA.NOTA)">
        <img src="assets/images/nota.png" alt="Nota">
        <span>Sin Comprobante</span>
      </button>
     
      <button class="boton-opcion btn-boleta" (click)="seleccionarComprobante(TIPO_VENTA.BOLETA)">
        <img src="assets/images/boleta.png" alt="Boleta">
        <span>Boleta (DNI)</span>
      </button>
     
      <button class="boton-opcion btn-factura" (click)="seleccionarComprobante(TIPO_VENTA.FACTURA)">
        <img src="assets/images/factura.png" alt="Factura">
        <span>Factura (RUC)</span>
      </button>
    </div>

    <button class="boton-volver" (click)="volverAPago()">
      <span>‚Üê</span> Volver
    </button>
  </div>

  <!-- 3Ô∏è‚É£ PASO 3: DOCUMENTO -->
  <div class="ventana-separada" *ngIf="pasoActual === Pasos.DOCUMENTO && !procesando">
    <h2>Ingrese {{ tipoDocumento }}</h2>
   
    <div class="resumen-pago">
      <p class="codigo-valor" style="font-size: 2rem; letter-spacing: 4px;">
        {{ numeroDocumento || '_ _ _ _ _ _ _ _' }}
      </p>
    </div>

    <div class="keypad">
      <div class="key-row">
        <button *ngFor="let n of [1,2,3]" (click)="addDocNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button *ngFor="let n of [4,5,6]" (click)="addDocNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button *ngFor="let n of [7,8,9]" (click)="addDocNumber(n.toString())">{{ n }}</button>
      </div>
      <div class="key-row">
        <button disabled style="opacity: 0.3;">.</button>
        <button (click)="addDocNumber('0')">0</button>
        <button (click)="deleteDocLast()" class="btn-del">‚å´</button>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn-si" (click)="confirmarDocumento()"
              [disabled]="(tipoDocumento === 'DNI' && numeroDocumento.length < 8) || 
                         (tipoDocumento === 'RUC' && numeroDocumento.length < 11)">
        Confirmar
      </button>
      <button class="btn-no" (click)="volverAComprobante()">
        Atr√°s
      </button>
    </div>
  </div>

</div>