<div class="venta-container">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <div class="card">
    <div class="card-header">
      <h2>Directorio de Proveedores</h2>
      <p class="card-subtitle">Gestiona tus socios comerciales y contactos</p>
    </div>

    <div class="filtros-container">
      <!-- Grupo izquierdo - Solo el buscador -->
      <div class="filtros-izquierda">
        <!-- 游댌 BUSCADOR COMPACTO Y ELEGANTE -->
        <div class="search-field-compact">
          <div class="input-group-compact">
            <span class="material-icons input-icon-compact">search</span>
            <input
              type="text"
              placeholder="Buscar proveedor, RUC, contacto..."
              (keyup)="applyFilter($event)"
              #input
              class="search-input-compact"
            />
            <button *ngIf="input.value" class="clear-search-btn-compact" (click)="limpiarFiltros()">
              <span class="material-icons">close</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Grupo derecho - Bot칩n agregar -->
      <div class="filtros-derecha">
        <!-- Bot칩n Nuevo Proveedor -->
        <button class="export-btn-text" (click)="openProveedorForm()" title="Nuevo Proveedor">
          <span class="material-icons">add</span>
          <span class="btn-text">Nuevo Proveedor</span>
        </button>
      </div>
    </div>

    <div *ngIf="loading" class="spinner-container">
      <div class="spinner"></div>
      <p>Cargando proveedores...</p>
    </div>

    <div class="table-container" *ngIf="dataSource.data.length > 0">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">tag</span>
                <span>ID</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">business</span>
                <span>EMPRESA</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">badge</span>
                <span>RUC</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">phone</span>
                <span>TEL칄FONO</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">person</span>
                <span>CONTACTO</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">toggle_on</span>
                <span>ESTADO</span>
              </div>
            </th>
            <th class="table-header date-column">
              <div class="header-content">
                <span class="material-icons">event</span>
                <span>REGISTRO</span>
              </div>
            </th>
            <th class="table-header acciones-column">
              <div class="header-content">
                <span class="material-icons">settings</span>
                <span>ACCIONES</span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of dataSource.filteredData" class="table-row">
            <td class="table-cell id-cell">
              <span class="id-badge">#{{ p.ID_Proveedor }}</span>
            </td>
            <td class="table-cell">
              <div class="empresa-info">
                <span class="name-text">{{ p.Nombre }}</span>
                <span class="email-text">{{ p.Email || 'Sin email' }}</span>
              </div>
            </td>
            <td class="table-cell">
              <span class="ruc-badge">{{ p.Ruc }}</span>
            </td>
            <td class="table-cell">
              <span class="telefono-text">{{ p.Telefono || '---' }}</span>
            </td>
            <td class="table-cell">
              <div class="contacto-info">
                <span class="material-icons small-icon">person</span>
                <span class="contacto-text">{{ p.Persona_Contacto || '---' }}</span>
              </div>
            </td>
            <td class="table-cell">
              <span [class]="'status-badge ' + getEstadoClass(p.Estado)">
                {{ getEstadoLabel(p.Estado) }}
              </span>
            </td>
            <td class="table-cell date-column">
              <span class="date-text">{{ p.Fecha_Registro | date : 'dd/MM/yyyy' }}</span>
            </td>
            <td class="table-cell acciones-column">
              <div class="acciones-container">
                <!-- Editar -->
                <button
                  class="action-btn edit-btn"
                  (click)="openProveedorForm(p)"
                  [disabled]="!canEdit(p.Estado)"
                  [matTooltip]="
                    canEdit(p.Estado) ? 'Editar' : 'No se puede editar proveedores inactivos'
                  "
                  [class.disabled-btn]="!canEdit(p.Estado)"
                >
                  <span class="material-icons">edit</span>
                </button>

                <!-- Toggle Estado -->
                <button
                  class="action-btn estado-btn"
                  [class.estado-activo]="p.Estado === 'A'"
                  [class.estado-inactivo]="p.Estado === 'I'"
                  (click)="cambiarEstadoProveedor(p)"
                  [disabled]="changingState === p.ID_Proveedor"
                  [matTooltip]="p.Estado === 'A' ? 'Desactivar' : 'Activar'"
                >
                  <span *ngIf="changingState !== p.ID_Proveedor" class="material-icons">
                    {{ p.Estado === 'A' ? 'toggle_on' : 'toggle_off' }}
                  </span>
                  <div *ngIf="changingState === p.ID_Proveedor" class="mini-spinner"></div>
                </button>

                <!-- Eliminar -->
                <button
                  class="action-btn delete-btn"
                  (click)="deleteProveedor(p)"
                  [disabled]="!canDelete(p.Estado)"
                  [matTooltip]="
                    canDelete(p.Estado) ? 'Eliminar' : 'No se puede eliminar proveedores activos'
                  "
                  [class.disabled-btn]="!canDelete(p.Estado)"
                >
                  <span class="material-icons">delete</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Mensaje cuando no hay datos -->
      <div *ngIf="dataSource.filteredData.length === 0 && input.value" class="no-data">
        <span class="material-icons no-data-icon">search_off</span>
        <h3>No se encontraron proveedores</h3>
        <p>No hay proveedores que coincidan con "{{ input.value }}"</p>
      </div>
    </div>

    <!-- Paginaci칩n de Angular Material -->
    <mat-paginator
      [pageSize]="5"
      [pageSizeOptions]="[5, 10, 20, 50]"
      showFirstLastButtons
      aria-label="Seleccionar p치gina de proveedores"
    >
    </mat-paginator>
  </div>
</div>
