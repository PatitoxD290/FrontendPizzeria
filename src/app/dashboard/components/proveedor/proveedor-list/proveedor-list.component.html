<div class="container-fluid p-4">
  
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 header-section">
    <div>
      <h1 class="mat-headline-5 mb-0">Directorio de Proveedores</h1>
      <p class="text-secondary mb-0">Gestiona tus socios comerciales y contactos</p>
    </div>
    <button mat-flat-button color="primary" (click)="openProveedorForm()">
      <mat-icon>add</mat-icon>
      Nuevo Proveedor
    </button>
  </div>

  <!-- Filtro -->
  <mat-form-field appearance="outline" class="w-100 search-field">
    <mat-label>Buscar proveedores...</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Nombre, RUC, Contacto..." #input>
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="mt-3">Cargando proveedores...</p>
  </div>

<<<<<<< HEAD
  <!-- Tabla -->
  <div class="mat-elevation-z8 table-container" [hidden]="loading">
    <table mat-table [dataSource]="dataSource" matSort>

      <!-- ID -->
      <ng-container matColumnDef="ID_Proveedor">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
        <td mat-cell *matCellDef="let row" class="text-secondary"> {{row.ID_Proveedor}} </td>
      </ng-container>

      <!-- Nombre -->
      <ng-container matColumnDef="Nombre">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Empresa </th>
        <td mat-cell *matCellDef="let row"> 
          <div class="fw-medium">{{row.Nombre}}</div>
          <div class="small text-muted">{{row.Email || 'Sin email'}}</div>
        </td>
      </ng-container>

      <!-- RUC -->
      <ng-container matColumnDef="Ruc">
        <th mat-header-cell *matHeaderCellDef> RUC </th>
        <td mat-cell *matCellDef="let row"> 
          <mat-chip-option disabled class="ruc-chip">{{row.Ruc}}</mat-chip-option> 
        </td>
      </ng-container>

      <!-- Teléfono -->
      <ng-container matColumnDef="Telefono">
        <th mat-header-cell *matHeaderCellDef> Teléfono </th>
        <td mat-cell *matCellDef="let row"> {{row.Telefono || '---'}} </td>
      </ng-container>

      <!-- Contacto -->
      <ng-container matColumnDef="Persona_Contacto">
        <th mat-header-cell *matHeaderCellDef> Contacto </th>
        <td mat-cell *matCellDef="let row"> 
          <div class="d-flex align-items-center">
            <mat-icon class="small-icon me-1 text-muted">person</mat-icon>
            {{row.Persona_Contacto || '---'}}
          </div>
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="Estado">
        <th mat-header-cell *matHeaderCellDef class="text-center"> Estado </th>
        <td mat-cell *matCellDef="let row" class="text-center">
          <span [class]="'status-badge ' + getEstadoClass(row.Estado)">
            {{ getEstadoLabel(row.Estado) }}
          </span>
        </td>
      </ng-container>
      
      <!-- Fecha Registro -->
      <ng-container matColumnDef="Fecha_Registro">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Registrado </th>
        <td mat-cell *matCellDef="let row"> {{row.Fecha_Registro | date:'dd/MM/yyyy'}} </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="text-center"> Acciones </th>
        <td mat-cell *matCellDef="let row" class="text-center">
          
          <!-- Toggle Estado -->
          <button mat-icon-button 
                  [color]="row.Estado === 'A' ? 'warn' : 'primary'"
                  (click)="cambiarEstadoProveedor(row)" 
                  [matTooltip]="row.Estado === 'A' ? 'Desactivar' : 'Activar'"
                  [disabled]="changingState === row.ID_Proveedor">
            <mat-spinner *ngIf="changingState === row.ID_Proveedor" diameter="20"></mat-spinner>
            <mat-icon *ngIf="changingState !== row.ID_Proveedor">
              {{ row.Estado === 'A' ? 'block' : 'check_circle' }}
            </mat-icon>
          </button>

          <!-- Editar -->
          <button mat-icon-button color="primary" (click)="openProveedorForm(row)" matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>

          <!-- Eliminar -->
          <button mat-icon-button color="warn" (click)="deleteProveedor(row)" matTooltip="Eliminar">
            <mat-icon>delete</mat-icon>
          </button>

        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
=======
  <!-- Contenedor para scroll horizontal -->
  <div class="table-container" *ngIf="!loading">
    <table mat-table [dataSource]="proveedores" class="mat-elevation-z8">

      <ng-container matColumnDef="proveedor_id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let p" [title]="p.ID_Proveedor">{{ p.ID_Proveedor }}</td>
      </ng-container>

      <ng-container matColumnDef="nombre_proveedor">
        <th mat-header-cell *matHeaderCellDef>Nombre</th>
        <td mat-cell *matCellDef="let p" [title]="p.Nombre">{{ p.Nombre }}</td>
      </ng-container>

      <ng-container matColumnDef="ruc">
        <th mat-header-cell *matHeaderCellDef>RUC</th>
        <td mat-cell *matCellDef="let p" [title]="p.Ruc">{{ p.Ruc }}</td>
      </ng-container>

      <ng-container matColumnDef="direccion">
        <th mat-header-cell *matHeaderCellDef>Dirección</th>
        <td mat-cell *matCellDef="let p" [title]="p.Direccion">{{ p.Direccion }}</td>
      </ng-container>

      <ng-container matColumnDef="telefono">
        <th mat-header-cell *matHeaderCellDef>Teléfono</th>
        <td mat-cell *matCellDef="let p" [title]="p.Telefono">{{ p.Telefono }}</td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let p" [title]="p.Email">{{ p.Email }}</td>
      </ng-container>

      <ng-container matColumnDef="persona_contacto">
        <th mat-header-cell *matHeaderCellDef>Contacto</th>
        <td mat-cell *matCellDef="let p" [title]="p.Persona_Contacto">{{ p.Persona_Contacto }}</td>
      </ng-container>

      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let p">
          <span [class.estado-activo]="p.Estado === 'A'" 
                [class.estado-inactivo]="p.Estado === 'I'">
            {{ p.Estado === 'A' ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="fecha_registro">
        <th mat-header-cell *matHeaderCellDef>Fecha Registro</th>
        <td mat-cell *matCellDef="let p" [title]="p.Fecha_Registro | date:'dd/MM/yyyy'">
          {{ p.Fecha_Registro | date:'dd/MM/yyyy' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let p">
          <div class="acciones-container">
            <!-- Botón Editar - Deshabilitado si está inactivo -->
            <button mat-icon-button color="primary" 
                    (click)="openProveedorForm(p)"
                    [disabled]="!canEditProveedor(p.Estado) || changingState === p.ID_Proveedor"
                    [title]="canEditProveedor(p.Estado) ? 'Editar proveedor' : 'No se puede editar un proveedor inactivo'">
              <mat-icon>edit</mat-icon>
            </button>

            <!-- Botón Cambiar Estado -->
            <button mat-icon-button 
                    [color]="getEstadoButtonColor(p.Estado)"
                    (click)="cambiarEstadoProveedor(p)"
                    [disabled]="changingState === p.ID_Proveedor"
                    [title]="getEstadoButtonText(p.Estado) + ' proveedor'">
              <mat-icon *ngIf="changingState !== p.ID_Proveedor">
                {{ getEstadoButtonIcon(p.Estado) }}
              </mat-icon>
              <mat-spinner *ngIf="changingState === p.ID_Proveedor" 
                          diameter="20"></mat-spinner>
            </button>

            <!-- Botón Eliminar - Deshabilitado si está activo -->
            <button mat-icon-button color="warn" 
                    (click)="deleteProveedor(p.ID_Proveedor)"
                    [disabled]="!canDeleteProveedor(p.Estado) || changingState === p.ID_Proveedor"
                    [title]="canDeleteProveedor(p.Estado) ? 'Eliminar proveedor' : 'No se puede eliminar un proveedor activo'">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </div>
>>>>>>> 71628ab0a6a7f3d7dbb4c222b0490f1c7f17032c

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center py-4" colspan="8">
          No se encontraron proveedores que coincidan con "{{input.value}}"
        </td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>
  </div>
</div>