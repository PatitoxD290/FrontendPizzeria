<mat-toolbar class="navbar" [class.sidebar-collapsed]="isSidebarCollapsed" *ngIf="mostrarNavbar">
  
  <div class="navbar-left">
    <button mat-icon-button class="menu-btn" (click)="toggleSidebar()">
      <mat-icon>menu</mat-icon>
    </button>

    <div class="logo-container" (click)="navigateTo('/dashboard/home')">
      <div class="logo-icon">
        <img src="/assets/imgs/logop.jpg" alt="Logo Pizzería" class="logo-img">
      </div>
    </div>
  </div>

  <div class="navbar-center">
    <div class="search-container">
      <div class="search-bar" [class.search-active]="showSuggestions">
        <div class="search-input-container">
          <mat-icon class="search-icon">search</mat-icon>
          <input 
            type="text" 
            placeholder="Buscar pedidos, clientes, productos..." 
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
            (focus)="onSearchFocus()"
            (blur)="onSearchBlur()"
            class="search-input">
          <button mat-icon-button class="clear-btn" *ngIf="searchQuery" (click)="clearSearch()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
      
      <!-- SUGERENCIAS DE BÚSQUEDA MEJORADAS -->
      <div class="search-suggestions" *ngIf="showSuggestions && searchQuery">
        <div class="suggestion-header">
          <mat-icon class="suggestion-header-icon">search</mat-icon>
          <span class="suggestion-header-text">Resultados para "{{ searchQuery }}"</span>
        </div>
        
        <div class="suggestion-category">
          <div class="category-title">Búsqueda rápida</div>
          <div class="suggestion-item" (click)="searchByType('pedido')">
            <div class="suggestion-icon-wrapper">
              <div class="suggestion-icon-bg pedido">
                <mat-icon>receipt_long</mat-icon>
              </div>
            </div>
            <div class="suggestion-content">
              <span class="suggestion-title">Pedidos</span>
              <span class="suggestion-desc">Buscar en pedidos</span>
            </div>
            <div class="suggestion-shortcut">
              <span class="shortcut-text">Enter</span>
            </div>
          </div>
          
          <div class="suggestion-item" (click)="searchByType('cliente')">
            <div class="suggestion-icon-wrapper">
              <div class="suggestion-icon-bg cliente">
                <mat-icon>person</mat-icon>
              </div>
            </div>
            <div class="suggestion-content">
              <span class="suggestion-title">Clientes</span>
              <span class="suggestion-desc">Buscar en clientes</span>
            </div>
          </div>
          
          <div class="suggestion-item" (click)="searchByType('producto')">
            <div class="suggestion-icon-wrapper">
              <div class="suggestion-icon-bg producto">
                <mat-icon>inventory_2</mat-icon>
              </div>
            </div>
            <div class="suggestion-content">
              <span class="suggestion-title">Productos</span>
              <span class="suggestion-desc">Buscar en productos</span>
            </div>
          </div>
        </div>

        <div class="suggestion-footer">
          <div class="footer-tip">
            <mat-icon>keyboard</mat-icon>
            <span>Presiona Enter para búsqueda general</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="navbar-right">
    <button mat-icon-button class="action-btn" (click)="openNotifications()" matTooltip="Notificaciones">
      <div class="notification-wrapper">
        <mat-icon>notifications</mat-icon>
        <span class="notification-badge" *ngIf="notificationsCount > 0">
          {{ notificationsCount > 9 ? '9+' : notificationsCount }}
        </span>
      </div>
    </button>

    <button mat-icon-button class="action-btn" (click)="toggleDarkMode()" 
            [matTooltip]="isDarkMode ? 'Modo Claro' : 'Modo Oscuro'">
      <mat-icon>{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
    </button>

    <!-- BOTÓN DE PERFIL CON ÍCONO Y TEXTO -->
    <button mat-button class="profile-btn" [matMenuTriggerFor]="userMenu">
      <div class="profile-content">
        <div class="user-avatar-small">
          <div class="avatar-circle">
            <mat-icon class="avatar-icon">person</mat-icon>
          </div>
        </div>
        <div class="user-info-compact">
          <span class="user-name">{{ nombreUsuario }}</span>
          <span class="user-role">Administrador</span>
        </div>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </div>
    </button>
  </div>

  <!-- MENÚ DE USUARIO CON ÍCONO -->
  <mat-menu #userMenu="matMenu" class="user-menu" yPosition="below" xPosition="before">
    <!-- Header del usuario CON ÍCONO -->
    <div class="user-menu-header">
      <div class="user-avatar-large">
        <div class="avatar-circle-large">
          <mat-icon class="avatar-icon-large">person</mat-icon>
        </div>
      </div>
      <div class="user-info">
        <span class="user-name-large">{{ nombreUsuario }}</span>
        <span class="user-email">usuario@ejemplo.com</span>
      </div>
    </div>
    
    <mat-divider></mat-divider>
    
    <!-- Opciones del menú -->
    <button mat-menu-item (click)="navigateTo('/dashboard/cambiar-contrasena')" class="menu-item">
      <div class="menu-item-content">
        <div class="menu-icon-wrapper">
          <mat-icon class="menu-icon">lock</mat-icon>
        </div>
        <span>Cambiar contraseña</span>
      </div>
    </button>
    
    <button mat-menu-item (click)="navigateTo('/dashboard/configuracion')" class="menu-item">
      <div class="menu-item-content">
        <div class="menu-icon-wrapper">
          <mat-icon class="menu-icon">settings</mat-icon>
        </div>
        <span>Configuración</span>
      </div>
    </button>
    
    <button mat-menu-item (click)="navigateTo('/dashboard/ayuda')" class="menu-item">
      <div class="menu-item-content">
        <div class="menu-icon-wrapper">
          <mat-icon class="menu-icon">help</mat-icon>
        </div>
        <span>Centro de Ayuda</span>
      </div>
    </button>
    
    <mat-divider></mat-divider>
    
    <!-- Opción de cierre de sesión -->
    <button mat-menu-item (click)="logout()" class="logout-item menu-item">
      <div class="menu-item-content">
        <div class="menu-icon-wrapper">
          <mat-icon class="menu-icon logout-icon">logout</mat-icon>
        </div>
        <span>Cerrar sesión</span>
      </div>
    </button>
  </mat-menu>
</mat-toolbar>