<div class="dashboard-container">
  
  <!-- Encabezado -->
  <div class="header-section">
    <h1>Dashboard</h1>
    <p class="date-text">{{ currentDate }}</p>
  </div>

  <!-- Cards principales -->
  <div class="stats-cards">
    
    <!-- Ventas Totales -->
    <div class="stat-card sales-card">
      <div class="icon-container sales">
        <mat-icon>trending_up</mat-icon>
      </div>
      <div class="card-content">
        <h3>Ventas Mensuales</h3>
        <p class="stat-value" *ngIf="!loadingCards">{{ formatCurrency(ventasTotales) }}</p>
        <mat-spinner diameter="20" *ngIf="loadingCards"></mat-spinner>
        <div class="trend-container">
          <span class="trend-indicator trend-up">{{ tendenciaVentasTotales }}</span>
          <span class="trend-text">vs mes anterior</span>
        </div>
      </div>
    </div>

    <!-- Pedidos Hoy -->
    <div class="stat-card orders-card">
      <div class="icon-container orders">
        <mat-icon>shopping_bag</mat-icon>
      </div>
      <div class="card-content">
        <h3>Pedidos Hoy</h3>
        <p class="stat-value" *ngIf="!loadingCards">{{ pedidosHoy }}</p>
        <mat-spinner diameter="20" *ngIf="loadingCards"></mat-spinner>
        <div class="trend-container">
          <span class="trend-indicator trend-up">{{ tendenciaPedidosHoy }}</span>
          <span class="trend-text">vs ayer</span>
        </div>
      </div>
    </div>

    <!-- Ventas de hoy -->
    <div class="stat-card product-card">
      <div class="icon-container income">
        <mat-icon>attach_money</mat-icon>
      </div>
      <div class="card-content">
        <h3>Ingresos de Hoy</h3>
        <p class="stat-value" *ngIf="!loadingCards">{{ formatCurrency(ventasHoy) }}</p>
        <mat-spinner diameter="20" *ngIf="loadingCards"></mat-spinner>
        <div class="trend-container">
          <span class="trend-indicator trend-up">{{ tendenciaVentasHoy }}</span>
          <span class="trend-text">vs ayer</span>
        </div>
      </div>
    </div>

    <!-- Total Clientes -->
    <div class="stat-card clients-card">
      <div class="icon-container clients">
        <mat-icon>group</mat-icon>
      </div>
      <div class="card-content">
        <h3>Total Clientes</h3>
        <p class="stat-value" *ngIf="!loadingCards">{{ totalClientes }}</p>
        <mat-spinner diameter="20" *ngIf="loadingCards"></mat-spinner>
        <div class="trend-container">
          <span class="trend-indicator trend-up">{{ tendenciaClientes }}</span>
          <span class="trend-text">este mes</span>
        </div>
      </div>
    </div>

  </div>

  <!-- Sección Gráfico -->
  <div class="contenedor-grafico">
    <div class="header-grafico">
      <h2>Resumen de Ventas</h2>
      <!-- Referencia local #sel para pasar el valor string al TS -->
      <select #sel (change)="cambiarPeriodoGrafico(sel.value)" class="periodo-select">
        <option value="Esta Semana" [selected]="periodoGrafico === 'Esta Semana'">Esta Semana</option>
        <option value="Semana Pasada" [selected]="periodoGrafico === 'Semana Pasada'">Semana Pasada</option>
        <option value="Último Mes" [selected]="periodoGrafico === 'Último Mes'">Último Mes</option>
      </select>
    </div>

    <div class="grafico-wrapper" *ngIf="!loadingChart">
      <!-- Eje Y -->
      <div class="eje-y">
        <span>{{ formatCurrency(maxVentaSemana) }}</span>
        <span>{{ formatCurrency(maxVentaSemana * 0.75) }}</span>
        <span>{{ formatCurrency(maxVentaSemana * 0.5) }}</span>
        <span>{{ formatCurrency(maxVentaSemana * 0.25) }}</span>
        <span>S/ 0</span>
      </div>

      <!-- Área de Barras -->
      <div class="area-barras">
        <!-- Líneas de referencia -->
        <div class="linea-referencia" style="top: 0%"></div>
        <div class="linea-referencia" style="top: 25%"></div>
        <div class="linea-referencia" style="top: 50%"></div>
        <div class="linea-referencia" style="top: 75%"></div>
        <div class="linea-referencia" style="top: 100%"></div>

        <!-- Barras -->
        <div class="barra-grupo" *ngFor="let venta of ventasSemanales; let i = index">
          <div class="barra" [style.height]="calcularAlturaBarra(venta)">
            <span class="tooltip-valor">{{ getValorBarra(i) }}</span>
          </div>
          <span class="etiqueta-eje-x">
            {{ ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'][i] }}
          </span>
        </div>
      </div>
    </div>

    <!-- Loading Chart -->
    <div *ngIf="loadingChart" class="loading-chart">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando datos...</p>
    </div>
  </div>

</div>