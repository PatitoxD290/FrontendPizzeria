<div class="venta-container">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <div class="card">
    <div class="card-header">
      <h2>Gesti贸n de Inventario</h2>
      <p class="card-subtitle">Control de stock, lotes y movimientos</p>
    </div>

    <div class="filtros-container">
      <!-- Grupo izquierdo - Solo el buscador -->
      <div class="filtros-izquierda">
        <!--  BUSCADOR COMPACTO Y ELEGANTE -->
        <div class="search-field-compact">
          <div class="input-group-compact">
            <span class="material-icons input-icon-compact">search</span>
            <input
              type="text"
              placeholder="Buscar por insumo, proveedor, estado..."
              (keyup)="applyFilter($event)"
              #input
              class="search-input-compact">
            <button *ngIf="input.value" class="clear-search-btn-compact" (click)="limpiarFiltros()">
              <span class="material-icons">close</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Grupo derecho - Botones -->
      <div class="filtros-derecha">
        <!-- Bot贸n Exportar PDF -->
        <button class="export-btn-text pdf-btn" 
                (click)="exportarPDF()"
                [disabled]="loading || dataSource.filteredData.length === 0"
                title="Generar reporte PDF de inventario">
          <span class="material-icons">picture_as_pdf</span>
          <span class="btn-text">Exportar PDF</span>
        </button>

        <!-- Bot贸n Nueva Entrada -->
        <button class="export-btn-text" (click)="openMovimientoModal()" title="Nueva Entrada">
          <span class="material-icons">add_box</span>
          <span class="btn-text">Nueva Entrada</span>
        </button>
      </div>
    </div>

    <div *ngIf="loading" class="spinner-container">
      <div class="spinner"></div>
      <p>Cargando inventario...</p>
    </div>

    <div class="table-container" *ngIf="dataSource.data.length > 0">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">inventory</span>
                <span>LOTE</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">category</span>
                <span>INSUMO</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">business</span>
                <span>PROVEEDOR</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">scale</span>
                <span>CANTIDAD</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">trending_up</span>
                <span>NIVEL STOCK</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">payments</span>
                <span>VALOR LOTE</span>
              </div>
            </th>
            <th class="table-header date-column">
              <div class="header-content">
                <span class="material-icons">event</span>
                <span>ENTRADA</span>
              </div>
            </th>
            <th class="table-header date-column">
              <div class="header-content">
                <span class="material-icons">event_busy</span>
                <span>VENCIMIENTO</span>
              </div>
            </th>
            <th class="table-header acciones-column">
              <div class="header-content">
                <span class="material-icons">settings</span>
                <span>ACCIONES</span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stock of dataSource.filteredData" class="table-row">
            <td class="table-cell id-cell">
              <span class="id-badge">#{{ stock.ID_Stock }}</span>
            </td>
            <td class="table-cell">
              <div class="empresa-info">
                <span class="name-text">{{ stock.Nombre_Insumo }}</span>
                <span class="email-text">{{ stock.Unidad_Med }}</span>
              </div>
            </td>
            <td class="table-cell">
              <span class="proveedor-text">{{ getNombreProveedor(stock.ID_Proveedor) }}</span>
            </td>
            <td class="table-cell">
              <span class="cantidad-badge">{{ stock.Cantidad_Recibida }}</span>
            </td>
            <td class="table-cell">
              <div class="nivel-stock-container">
                <div class="nivel-header">
                  <span class="estado-text">{{ stock.Estado_Llenado }}</span>
                  <span class="porcentaje-text">{{ stock.Valor_Porcentaje }}%</span>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar" [style.width.%]="stock.Valor_Porcentaje" 
                       [class]="getProgressBarClass(stock.Valor_Porcentaje)"></div>
                </div>
              </div>
            </td>
            <td class="table-cell">
              <span class="costo-text">{{ stock.Costo_Total | currency:'S/ ' }}</span>
            </td>
            <td class="table-cell date-column">
              <span class="date-text">{{ stock.Fecha_Entrada | date:'dd/MM/yyyy' }}</span>
            </td>
            <td class="table-cell date-column">
              <span *ngIf="stock.Fecha_Vencimiento" 
                    [class]="'vencimiento-badge ' + getEstadoVencimientoClass(stock.Fecha_Vencimiento)">
                {{ stock.Fecha_Vencimiento | date:'dd/MM/yyyy' }}
              </span>
              <span *ngIf="!stock.Fecha_Vencimiento" class="vencimiento-badge no-vencimiento">
                No vence
              </span>
            </td>
            <td class="table-cell acciones-column">
              <div class="acciones-container">
                <!-- Ver Movimientos -->
                <button 
                  class="action-btn history-btn" 
                  (click)="verMovimientos(stock)"
                  matTooltip="Ver historial de movimientos">
                  <span class="material-icons">history</span>
                </button>

                <!-- Registrar Movimiento -->
                <button 
                  class="action-btn movement-btn" 
                  (click)="openMovimientoModal(stock)"
                  matTooltip="Registrar movimiento">
                  <span class="material-icons">swap_vert</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Mensaje cuando no hay datos -->
      <div *ngIf="dataSource.filteredData.length === 0 && input.value" class="no-data">
        <span class="material-icons no-data-icon">search_off</span>
        <h3>No se encontraron registros</h3>
        <p>No hay registros que coincidan con "{{input.value}}"</p>
      </div>
    </div>

    <!-- Mensaje cuando no hay datos iniciales -->
    <div *ngIf="dataSource.data.length === 0 && !loading && !input.value" class="no-data">
      <span class="material-icons no-data-icon">inventory_2</span>
      <h3>No hay registros de inventario</h3>
      <p>Comienza agregando tu primer registro de stock</p>
      <button class="export-btn-text" (click)="openMovimientoModal()">
        <span class="material-icons">add</span>
        <span class="btn-text">Agregar primer registro</span>
      </button>
    </div>

    <!-- Paginaci贸n de Angular Material -->
    <mat-paginator 
      [pageSize]="5" 
      [pageSizeOptions]="[5, 10, 20, 50]"
      showFirstLastButtons
      aria-label="Seleccionar p谩gina de inventario">
    </mat-paginator>
  </div>
</div>