<div class="dialog-header">
  <h2 mat-dialog-title class="m-0">Agregar Producto</h2>
  <button mat-icon-button (click)="cancelar()">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content class="dialog-content">
  
  <!-- Tarjeta Principal -->
  <div class="product-summary">
    <div class="icon-container">
      <mat-icon class="product-icon">restaurant</mat-icon>
    </div>
    <h3 class="product-title">{{ producto.Nombre }}</h3>
    <p class="product-desc">{{ producto.Descripcion || 'Sin descripci칩n' }}</p>
    
    <div class="tags">
      <span class="tag-category">{{ producto.nombre_categoria || 'General' }}</span>
      <span class="tag-stock" [class.agotado]="producto.Cantidad_Disponible === 0">
        {{ stockTexto }}
      </span>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Detalles de Precio (Si existe tama침o) -->
  <div *ngIf="primerTamano; else noPrice" class="price-details">
    
    <div class="info-row">
      <span class="label">Precio Unitario:</span>
      <span class="value">S/ {{ primerTamano.Precio | number:'1.2-2' }}</span>
    </div>
    <div class="info-row text-muted">
      <span class="label">Tama침o:</span>
      <span class="value">{{ primerTamano.nombre_tamano || 'Est치ndar' }}</span>
    </div>

    <!-- Control de Cantidad -->
    <div class="qty-container">
      <span class="qty-label">Cantidad:</span>
      <div class="qty-controls">
        <button mat-mini-fab color="basic" (click)="decrementarCantidad()" [disabled]="cantidad <= 1">
          <mat-icon>remove</mat-icon>
        </button>
        
        <input type="number" 
               class="qty-input" 
               [value]="cantidad" 
               (input)="validarCantidad($event)">
        
        <button mat-mini-fab color="basic" (click)="incrementarCantidad()" [disabled]="cantidad >= maxCantidad">
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>

    <!-- Total -->
    <div class="total-box">
      <span class="total-label">Total a Pagar:</span>
      <span class="total-amount">S/ {{ getPrecioTotal() | number:'1.2-2' }}</span>
    </div>

  </div>

  <!-- Template Error: Sin Precios -->
  <ng-template #noPrice>
    <div class="error-state">
      <mat-icon color="warn">money_off</mat-icon>
      <p>Este producto no tiene precios configurados.</p>
    </div>
  </ng-template>

</mat-dialog-content>

<mat-dialog-actions align="end" class="actions-container">
  <button mat-button (click)="cancelar()">Cancelar</button>
  <button mat-flat-button color="primary" (click)="agregarAlPedido()" 
          [disabled]="!primerTamano || cantidad <= 0" class="btn-add">
    <mat-icon>add_shopping_cart</mat-icon>
    Agregar
  </button>
</mat-dialog-actions>