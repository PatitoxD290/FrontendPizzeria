<div class="container-fluid p-4">
  
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 header-section">
    <div>
      <h1 class="mat-headline-5 mb-0">Cat√°logo de Productos</h1>
      <p class="text-secondary mb-0">Gestiona tus productos, precios y stock</p>
    </div>
    <button mat-flat-button color="primary" (click)="openProductoForm()">
      <mat-icon>add</mat-icon> Nuevo Producto
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters-container mat-elevation-z1 mb-4">
    
    <!-- Buscador -->
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar producto</mat-label>
      <input matInput [(ngModel)]="terminoBusqueda" (keyup)="aplicarFiltros()" placeholder="Nombre, descripci√≥n...">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
    
    <!-- Selector Categor√≠a -->
    <mat-form-field appearance="outline" class="category-field">
      <mat-label>Categor√≠a</mat-label>
      <mat-select [(ngModel)]="filtroCategoria" (selectionChange)="aplicarFiltros()">
        <mat-option [value]="0">Todas</mat-option>
        <mat-option *ngFor="let c of categorias" [value]="c.ID_Categoria_P">
          {{ c.Nombre }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-icon-button color="warn" *ngIf="terminoBusqueda || filtroCategoria !== 0" (click)="limpiarFiltros()" matTooltip="Limpiar filtros">
      <mat-icon>filter_alt_off</mat-icon>
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="mt-3">Cargando cat√°logo...</p>
  </div>

  <!-- Grid -->
  <div *ngIf="!loading" class="products-grid">
    <mat-card *ngFor="let p of paginatedProductos" class="product-card">
      
      <!-- Imagen y Badges -->
      <div class="card-image">
        <!-- üñºÔ∏è Aqu√≠ se usa la funci√≥n corregida con /imagenesCata/ -->
        <img [src]="getProductoImage(p)" [alt]="p.Nombre" (error)="onImageError($event)">
        
        <span class="status-badge" [class.active]="p.Estado === 'A'">
          {{ p.Estado === 'A' ? 'Activo' : 'Inactivo' }}
        </span>
        
        <span class="stock-badge" [ngClass]="getStockClass(p.Cantidad_Disponible)">
          {{ p.Cantidad_Disponible }} unid.
        </span>
      </div>

      <!-- Contenido -->
      <mat-card-content class="p-3 card-content">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div style="overflow: hidden;">
            <h3 class="product-title" [matTooltip]="p.Nombre">{{ p.Nombre }}</h3>
            <span class="category-text">{{ p.nombre_categoria }}</span>
          </div>
        </div>

        <!-- Lista de Tama√±os/Precios -->
        <div class="sizes-list custom-scrollbar">
          <div *ngFor="let t of p.tamanos" class="size-item">
            <span class="size-name">{{ t.nombre_tamano }}</span>
            <span class="size-price">S/ {{ t.Precio | number:'1.2-2' }}</span>
          </div>
          <div *ngIf="!p.tamanos?.length" class="text-muted small text-center mt-2">
            Sin precios configurados
          </div>
        </div>
      </mat-card-content>

      <!-- Acciones -->
<<<<<<< HEAD
      <mat-card-actions align="end" class="card-actions">
        <button mat-icon-button color="primary" (click)="openProductoForm(p)" matTooltip="Editar">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteProducto(p)" matTooltip="Eliminar">
=======
       <mat-card-actions class="card-actions">
        <button 
          mat-icon-button 
          color="primary" 
          (click)="openProductoForm(producto)" 
          class="action-button"
          matTooltip="Editar producto"
          matTooltipPosition="above"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button 
          mat-icon-button 
          color="warn" 
          (click)="deleteProducto(producto)" 
          class="action-button"
          matTooltip="Eliminar producto"
          matTooltipPosition="above"
        >
>>>>>>> 71628ab0a6a7f3d7dbb4c222b0490f1c7f17032c
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- No Data -->
  <div *ngIf="!loading && paginatedProductos.length === 0" class="no-data">
    <mat-icon class="large-icon">search_off</mat-icon>
    <p>No se encontraron productos con los filtros actuales.</p>
  </div>

  <!-- Paginador -->
  <mat-paginator [length]="totalItems"
                 [pageSize]="pageSize"
                 [pageSizeOptions]="pageSizeOptions"
                 (page)="onPageChange($event)"
                 showFirstLastButtons
                 [hidden]="totalItems === 0">
  </mat-paginator>
</div>