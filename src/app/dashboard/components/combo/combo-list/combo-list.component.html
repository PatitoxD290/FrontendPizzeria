<div class="products-container">
  <!-- Header -->
  <div class="products-header">
    <div>
      <h1 class="page-title">Gestión de Combos</h1>
      <p class="subtitle">Administra tus ofertas y promociones</p>
    </div>
    <button mat-flat-button color="primary" (click)="crearCombo()" class="add-button">
      <mat-icon>add</mat-icon>
      Nuevo Combo
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters-section mat-elevation-z1">
    <div class="search-box">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        [(ngModel)]="terminoBusqueda"
        (keyup)="aplicarFiltros()"
        placeholder="Buscar por nombre o descripción..."
        class="search-input"
      >
      <button *ngIf="terminoBusqueda" mat-icon-button (click)="limpiarBusqueda()" class="clear-btn">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="filter-chips">
      <mat-chip-listbox>
        <mat-chip-option 
          [selected]="filtroEstado === 'todos'" 
          (click)="filtroEstado = 'todos'; aplicarFiltros()">
          Todos
        </mat-chip-option>
        <mat-chip-option 
          color="primary" 
          [selected]="filtroEstado === 'A'" 
          (click)="filtroEstado = 'A'; aplicarFiltros()">
          Activos
        </mat-chip-option>
        <mat-chip-option 
          color="warn" 
          [selected]="filtroEstado === 'I'" 
          (click)="filtroEstado = 'I'; aplicarFiltros()">
          Inactivos
        </mat-chip-option>
      </mat-chip-listbox>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="spinner-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando combos...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !cargando" class="error-state">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h3>{{ error }}</h3>
    <button mat-stroked-button color="primary" (click)="cargarCombos()">Reintentar</button>
  </div>

  <!-- Grid de Combos -->
  <div *ngIf="!cargando && !error" class="content-wrapper">
    
    <!-- Sin resultados -->
    <div *ngIf="paginatedCombos.length === 0" class="no-data">
      <mat-icon class="no-data-icon">fastfood</mat-icon>
      <h3>No se encontraron combos</h3>
      <p *ngIf="terminoBusqueda">Intenta con otros términos de búsqueda</p>
      <p *ngIf="!terminoBusqueda">¡Crea tu primer combo para empezar a vender!</p>
    </div>

    <div class="products-grid">
      <mat-card *ngFor="let combo of paginatedCombos" class="product-card">
        
        <!-- Imagen y Estado -->
        <div class="card-image-header">
          <img [src]="getComboImage(combo)" [alt]="combo.Nombre" (error)="onImageError($event)">
          <div class="status-badge" [class.active]="combo.Estado === 'A'">
            {{ getEstadoText(combo.Estado) }}
          </div>
          <div class="price-badge">
            S/ {{ combo.Precio | number:'1.2-2' }}
          </div>
        </div>

        <mat-card-content class="card-content">
          <div class="title-section">
            <h3 class="combo-title" [matTooltip]="combo.Nombre">{{ combo.Nombre }}</h3>
            <span class="id-text">#{{ combo.ID_Combo }}</span>
          </div>
          
          <p class="description" [matTooltip]="combo.Descripcion || ''">
            {{ combo.Descripcion || 'Sin descripción' }}
          </p>

          <div class="details-section">
            <div class="detail-item" [matTooltip]="getProductosInfo(combo)" matTooltipClass="multiline-tooltip">
              <mat-icon>restaurant</mat-icon>
              <span>{{ combo.detalles?.length || 0 }} Productos</span>
            </div>
          </div>
        </mat-card-content>

        <mat-card-actions class="card-actions">
          <button mat-icon-button 
                  [color]="combo.Estado === 'A' ? 'warn' : 'accent'" 
                  (click)="toggleEstadoCombo(combo)" 
                  [matTooltip]="combo.Estado === 'A' ? 'Desactivar' : 'Activar'">
            <mat-icon>{{ combo.Estado === 'A' ? 'block' : 'check_circle' }}</mat-icon>
          </button>
          
          <button mat-icon-button color="primary" (click)="editarCombo(combo)" matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          
          <button mat-icon-button color="warn" (click)="eliminarCombo(combo)" matTooltip="Eliminar">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Paginador -->
    <mat-paginator [length]="totalItems"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   (page)="onPageChange($event)"
                   [hidden]="totalItems === 0"
                   showFirstLastButtons
                   class="custom-paginator">
    </mat-paginator>
  </div>
</div>