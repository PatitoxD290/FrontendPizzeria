<<<<<<< HEAD
<div class="container-fluid p-4">
  
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 header-section">
    <div>
      <h1 class="mat-headline-5 mb-0">Gestión de Usuarios</h1>
      <p class="text-secondary mb-0">Administra los accesos y roles del sistema</p>
    </div>
    <button mat-flat-button color="primary" (click)="openNuevo()">
      <mat-icon>person_add</mat-icon>
      Nuevo Usuario
    </button>
  </div>

  <!-- Filtro -->
  <mat-form-field appearance="outline" class="w-100 search-field">
    <mat-label>Buscar usuario...</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Nombre, correo, rol..." #input>
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="mt-3">Cargando usuarios...</p>
  </div>

  <!-- Tabla -->
  <div class="mat-elevation-z8 table-container" [hidden]="loading">
    <table mat-table [dataSource]="dataSource" matSort>

      <!-- ID -->
      <ng-container matColumnDef="ID_Usuario">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
        <td mat-cell *matCellDef="let row" class="text-secondary"> {{row.ID_Usuario}} </td>
      </ng-container>

      <!-- Perfil (Nombre) -->
      <ng-container matColumnDef="Perfil">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre Completo </th>
        <td mat-cell *matCellDef="let row" class="fw-medium"> 
          {{row.Perfil}} 
        </td>
      </ng-container>

      <!-- Correo -->
      <ng-container matColumnDef="Correo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Correo / DNI </th>
        <td mat-cell *matCellDef="let row"> {{row.Correo}} </td>
      </ng-container>

      <!-- Rol -->
      <ng-container matColumnDef="Roll">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Rol </th>
        <td mat-cell *matCellDef="let row"> 
          <span [class]="'rol-badge ' + getRolClass(row.Roll)">
            {{ getRolText(row.Roll) }}
          </span>
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="Estado">
        <th mat-header-cell *matHeaderCellDef class="text-center"> Estado </th>
        <td mat-cell *matCellDef="let row" class="text-center">
          <span [class]="'status-badge ' + getEstadoClass(row.Estado)">
            {{ getEstadoLabel(row.Estado) }}
          </span>
        </td>
      </ng-container>

      <!-- Fecha Registro -->
      <ng-container matColumnDef="Fecha_Registro">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Registrado </th>
        <td mat-cell *matCellDef="let row" class="text-muted"> {{row.Fecha_Registro | date:'dd/MM/yyyy'}} </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="text-center"> Acciones </th>
        <td mat-cell *matCellDef="let row" class="text-center">
          
          <!-- Toggle Estado -->
          <button mat-icon-button 
                  [color]="row.Estado === 'A' ? 'warn' : 'accent'" 
                  (click)="toggleEstado(row)"
                  [matTooltip]="row.Estado === 'A' ? 'Desactivar acceso' : 'Activar acceso'">
            <mat-icon>{{ row.Estado === 'A' ? 'block' : 'check_circle' }}</mat-icon>
          </button>

          <!-- Editar Info -->
          <button mat-icon-button 
                  color="primary" 
                  (click)="openEditar(row)" 
                  [disabled]="!canEdit(row)"
                  matTooltip="Editar datos">
            <mat-icon>edit</mat-icon>
          </button>

          <!-- Cambiar Password -->
          <button mat-icon-button 
                  color="accent" 
                  (click)="openChangePassword(row)"
                  [disabled]="!canEdit(row)" 
                  matTooltip="Cambiar contraseña">
            <mat-icon>vpn_key</mat-icon>
          </button>

          <!-- Eliminar -->
          <button mat-icon-button 
                  color="warn" 
                  (click)="deleteUsuario(row)" 
                  [disabled]="!canDelete(row)"
                  matTooltip="Eliminar usuario">
            <mat-icon>delete</mat-icon>
          </button>

        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-row"></tr>

      <!-- Sin resultados -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center py-4" colspan="7">
          No se encontraron usuarios que coincidan con "{{input.value}}"
        </td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="Seleccionar página"></mat-paginator>
  </div>
=======
<!-- usuario-list.component.html -->
<div class="usuario-container">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <div class="card">
    <div class="card-header">
      <h2>Lista de Usuarios</h2>
      
      <!-- Botón Nuevo Usuario -->
      <button class="nuevo-usuario-btn" (click)="openNuevo()">
        <span class="material-icons">add</span>
        Nuevo Usuario
      </button>
    </div>

    <div *ngIf="loading" class="spinner-container">
      <div class="spinner"></div>
      <p>Cargando usuarios...</p>
    </div>

    <div class="table-container" *ngIf="!loading">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">tag</span>
                <span>ID</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">email</span>
                <span>CORREO / DNI</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">person</span>
                <span>NOMBRE </span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">admin_panel_settings</span>
                <span>ROL</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">toggle_on</span>
                <span>ESTADO</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">event</span>
                <span>FECHA REGISTRO</span>
              </div>
            </th>
            <th class="table-header">
              <div class="header-content">
                <span class="material-icons">settings</span>
                <span>ACCIONES</span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let usuario of usuarios" class="table-row">
            <td class="table-cell id-cell">
              <span class="id-badge">#{{ usuario.ID_Usuario }}</span>
            </td>
            <td class="table-cell">
              <span class="email-text">{{ usuario.Correo }}</span>
            </td>
            <td class="table-cell">
              <span class="name-text">{{ usuario.Perfil }}</span>
            </td>
            <td class="table-cell">
              <!-- SOLUCIÓN SIMPLE: Sin métodos TypeScript -->
              <span class="rol-badge" 
                    [class.empleado]="usuario.Roll === 'E'" 
                    [class.administrador]="usuario.Roll === 'A'">
                {{ usuario.Roll === 'A' ? 'Administrador' : 'Empleado' }}
              </span>
            </td>
            <td class="table-cell">
              <span class="estado-badge" 
                    [class.activo]="usuario.Estado === 'A'" 
                    [class.inactivo]="usuario.Estado === 'I'">
                {{ usuario.Estado === 'A' ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="table-cell">
              <span class="date-text">{{ usuario.Fecha_Registro | date:'dd/MM/yyyy, hh:mm a' }}</span>
            </td>
            <td class="table-cell acciones-cell">
              <div class="acciones-container">
                <!-- Editar usuario -->
                <button class="action-btn"
                        (click)="openEditar(usuario)"
                        [disabled]="!canEdit(usuario)"
                        [class.disabled]="!canEdit(usuario)"
                        title="Editar usuario">
                  <span class="material-icons">edit</span>
                </button>

                <!-- Cambiar contraseña -->
                <button class="action-btn"
                        (click)="openChangePassword(usuario)"
                        [disabled]="!canChangePassword(usuario)"
                        [class.disabled]="!canChangePassword(usuario)"
                        title="Cambiar contraseña">
                  <span class="material-icons">vpn_key</span>
                </button>

                <!-- Activar / Desactivar -->
                <button class="action-btn toggle-btn"
                        (click)="toggleEstado(usuario)"
                        [title]="usuario.Estado === 'A' ? 'Desactivar usuario' : 'Activar usuario'">
                  <span class="material-icons">
                    {{ usuario.Estado === 'A' ? 'block' : 'check' }}
                  </span>
                </button>

                <!-- Eliminar -->
                <button class="action-btn delete-btn"
                        (click)="deleteUsuario(usuario.ID_Usuario)"
                        [disabled]="!canDelete(usuario)"
                        [class.disabled]="!canDelete(usuario)"
                        title="Eliminar usuario">
                  <span class="material-icons">delete</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Mensaje cuando no hay datos -->
      <div *ngIf="usuarios.length === 0" class="no-data">
        <span class="material-icons no-data-icon">group_off</span>
        <h3>No se encontraron usuarios</h3>
        <p>No hay usuarios registrados en el sistema</p>
      </div>
    </div>

    <!-- Paginación -->
    <div class="pagination-container" *ngIf="usuarios.length > 0">
      <div class="pagination-info">
        Mostrando {{ usuarios.length }} usuarios
      </div>
      <div class="pagination-controls">
        <button class="pagination-btn" disabled>
          <span class="material-icons">chevron_left</span>
        </button>
        
        <div class="page-numbers">
          <button class="page-btn active">1</button>
        </div>
        
        <button class="pagination-btn" disabled>
          <span class="material-icons">chevron_right</span>
        </button>
      </div>
      <div class="page-size-selector">
        <select class="page-size-select" disabled>
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
        </select>
      </div>
    </div>
  </div>
>>>>>>> 71628ab0a6a7f3d7dbb4c222b0490f1c7f17032c
</div>