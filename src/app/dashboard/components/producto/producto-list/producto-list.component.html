<div class="products-container">
  <!-- Header con título y botón -->
  <div class="products-header">
    <h1 class="page-title">Catálogo de Productos</h1>
    <button mat-flat-button color="primary" (click)="openProductoForm()" class="add-button">
      <mat-icon>add</mat-icon>
      Nuevo Producto
    </button>
  </div>
<!-- Filtros con CSS puro -->
<div class="filters-container">
  <!-- Buscador CSS puro -->
  <div class="search-field">
    <input 
      type="text" 
      class="search-input"
      [(ngModel)]="terminoBusqueda" 
      (keyup)="aplicarFiltros()" 
      placeholder="Buscar producto..."
    >
    <mat-icon class="search-icon">search</mat-icon>
  </div>
  
  <!-- Selector Categoría CSS puro - CORREGIDO -->
  <div class="category-field">
    <select 
      class="category-select"
      [(ngModel)]="filtroCategoria" 
      (change)="onCategoriaChange($event)"
    >
      <option [value]="0">Todas las categorías</option>
      <option *ngFor="let c of categorias" [value]="c.ID_Categoria_P">
        {{ c.Nombre }}
      </option>
    </select>
  </div>

  <button 
    *ngIf="terminoBusqueda || filtroCategoria !== 0" 
    (click)="limpiarFiltros()" 
    class="clear-filters-btn"
    title="Limpiar filtros"
  >
    <mat-icon>filter_alt_off</mat-icon>
  </button>
</div>
    
  
  <!-- Stats bar -->
  <div *ngIf="!loading" class="stats-bar">
    <mat-chip-set>
      <mat-chip color="primary" highlighted>
        <mat-icon>inventory_2</mat-icon>
        Total: {{ productos.length }} productos
      </mat-chip>
      <mat-chip color="accent" highlighted>
        <mat-icon>visibility</mat-icon>
        Mostrando: {{ paginatedProductos.length }} productos
      </mat-chip>
      <mat-chip *ngIf="terminoBusqueda || filtroCategoria !== 0" color="warn" highlighted>
        <mat-icon>filter_alt</mat-icon>
        Filtros activos
      </mat-chip>
    </mat-chip-set>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="spinner-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando catálogo...</p>
  </div>

  <!-- Grid de Cards -->
  <div *ngIf="!loading && productos.length > 0" class="products-grid">
    <mat-card *ngFor="let producto of paginatedProductos" class="product-card">
      
      <!-- Header con imagen y estado -->
      <div class="card-header">
        <div class="image-container">
          <img 
            [src]="getProductoImage(producto)" 
            [alt]="producto.Nombre"
            class="product-image"
            (error)="onImageError($event)"
          >
          <div class="image-overlay">
            <mat-chip [class.estado-activo]="producto.Estado === 'A'" [class.estado-inactivo]="producto.Estado !== 'A'"
              class="status-chip">
              {{ getEstadoText(producto.Estado) }}
            </mat-chip>
          </div>
        </div>
      </div>

      <!-- Contenido principal -->
      <mat-card-content class="card-content">
        
        <!-- Información básica -->
        <div class="product-basic-info">
          <h3 class="product-name" [matTooltip]="producto.Nombre" matTooltipPosition="above">
            {{ producto.Nombre }}
          </h3>
        </div>

        <!-- Descripción -->
        <div class="product-description">
          <p class="description-text" [matTooltip]="producto.Descripcion || 'Sin descripción'" matTooltipPosition="above">
            {{ truncateText(producto.Descripcion || 'Sin descripción', 60) }}
          </p>
        </div>

        <!-- Categoría -->
        <div class="product-details">
          <div class="detail-item">
            <mat-icon class="detail-icon">category</mat-icon>
            <span class="detail-text">{{ producto.nombre_categoria }}</span>
          </div>
        </div>

        <!-- Stock -->
        <div class="stock-section">
          <mat-chip [color]="getStockColor(producto.Cantidad_Disponible)" class="stock-chip">
            <mat-icon>inventory</mat-icon>
            {{ producto.Cantidad_Disponible }} unidades
            <span class="stock-status">({{ getStockText(producto.Cantidad_Disponible) }})</span>
          </mat-chip>
        </div>

        <!-- Precios y Tamaños -->
        <div class="pricing-section" 
             [matTooltip]="getPrecioTamanoInfo(producto).tooltip" 
             matTooltipPosition="above">
          <div class="price-info">
            <mat-icon class="price-icon">attach_money</mat-icon>
            <span class="price-text">{{ getPrecioTamanoInfo(producto).texto }}</span>
          </div>
        </div>

        <!-- Lista de Tamaños (Scrollable) -->
        <div *ngIf="producto.tamanos && producto.tamanos.length > 0" class="sizes-list custom-scrollbar">
          <div *ngFor="let tamano of producto.tamanos" class="size-item">
            <span class="size-name">{{ tamano.nombre_tamano || 'Tamaño' }}</span>
            <span class="size-price">S/ {{ tamano.Precio | number:'1.2-2' }}</span>
          </div>
        </div>

      </mat-card-content>

      <!-- Acciones -->
      <mat-card-actions class="card-actions">
        <button 
          mat-icon-button 
          color="primary" 
          (click)="openProductoForm(producto)" 
          class="action-button"
          matTooltip="Editar producto"
          matTooltipPosition="above"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button 
          mat-icon-button 
          color="warn" 
          (click)="deleteProducto(producto)" 
          class="action-button"
          matTooltip="Eliminar producto"
          matTooltipPosition="above"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>

    </mat-card>
  </div>

  <!-- Paginación -->
  <div *ngIf="!loading && productos.length > 0" class="pagination-container">
    <mat-paginator 
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="currentPage"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="custom-paginator">
    </mat-paginator>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!loading && productos.length === 0" class="no-data">
    <mat-icon class="no-data-icon">inventory_2</mat-icon>
    <h3>No hay productos registrados</h3>
    <p>Comienza agregando tu primer producto al sistema</p>
    <button mat-flat-button color="primary" (click)="openProductoForm()">
      <mat-icon>add</mat-icon>
      Agregar primer producto
    </button>
  </div>

  <!-- Sin resultados con filtros -->
  <div *ngIf="!loading && productos.length > 0 && paginatedProductos.length === 0" class="no-data">
    <mat-icon class="no-data-icon">search_off</mat-icon>
    <h3>No se encontraron productos</h3>
    <p>No hay productos que coincidan con los filtros aplicados</p>
    <button mat-flat-button color="primary" (click)="limpiarFiltros()">
      <mat-icon>clear_all</mat-icon>
      Limpiar filtros
    </button>
  </div>
</div>