<div class="menu-container">
  
  <!-- ðŸ” Barra de BÃºsqueda -->
  <div class="search-section">
    <div class="search-box">
      <mat-icon>search</mat-icon>
      <input 
        type="text" 
        placeholder="Â¿QuÃ© desea ordenar hoy?" 
        [(ngModel)]="terminoBusqueda" 
        (keyup)="buscarProducto()">
      <button *ngIf="terminoBusqueda" mat-icon-button (click)="terminoBusqueda=''; buscarProducto()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- ðŸ·ï¸ CategorÃ­as - CORREGIDO: Tipos consistentes -->
  <div class="categorias-container">
    <!-- BotÃ³n Todos -->
    <button mat-raised-button 
            [color]="isCategoriaSeleccionada(null) ? 'primary' : ''" 
            (click)="filtrarPorCategoria(null)">
      Todos
    </button>

    <!-- BotÃ³n Combos -->
    <button mat-raised-button 
            [color]="isCategoriaSeleccionada(CATEGORIA_COMBOS) ? 'primary' : ''" 
            class="combo-category-btn"
            (click)="filtrarPorCategoria(CATEGORIA_COMBOS)">
      Combos
    </button>

    <!-- CategorÃ­as normales de productos -->
    <button *ngFor="let cat of categorias" 
            mat-raised-button 
            [color]="isCategoriaSeleccionada(cat.ID_Categoria_P) ? 'primary' : ''" 
            (click)="filtrarPorCategoria(cat.ID_Categoria_P)">
      {{ cat.Nombre }}
    </button>
  </div>

  <!-- ðŸŒ€ Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- ðŸ“¦ Grid de Productos y Combos -->
  <div *ngIf="!loading" class="products-grid" id="menu-grid">
    
    <mat-card 
      *ngFor="let item of paginatedItems" 
      class="product-card" 
      [class.combo-card]="item.esCombo"
      [class.disabled]="!item.disponible"
      (click)="abrirModalCantidad(item)">
      
      <div class="card-image">
        <img [src]="getProductoImage(item)" [alt]="item.nombre" (error)="onImageError($event)">
        
        <!-- Badge para combos -->
        <div class="combo-badge" *ngIf="item.esCombo">COMBO</div>
        
        <!-- Badge de stock bajo -->
        <div class="stock-badge" *ngIf="item.disponible && item.cantidadDisponible > 0 && item.cantidadDisponible <= 5 && !item.esCombo">
          Â¡Quedan {{item.cantidadDisponible}}!
        </div>
        
        <!-- Overlay para agotado -->
        <div class="agotado-overlay" *ngIf="!item.disponible">
          <span>AGOTADO</span>
        </div>
      </div>

      <mat-card-content class="card-content">
        <h3 class="product-title">
          {{ item.nombre }}
        </h3>
        
        <p class="product-category">{{ item.categoria }}</p>
        
        <p class="product-desc" *ngIf="item.descripcion">
          {{ item.descripcion }}
        </p>

        <!-- InformaciÃ³n de tamaÃ±os para productos -->
        <div class="size-info" *ngIf="!item.esCombo">
          <small>{{ item.tamanosDisponibles }}</small>
        </div>

        <!-- InformaciÃ³n de combo -->
        <div class="combo-info" *ngIf="item.esCombo" [matTooltip]="getInfoCombo(item)">
          <small><strong>Incluye:</strong> {{ getProductosCombo(item) }}</small>
        </div>
        
        <div class="product-footer">
          <span class="price-tag" [class.combo-price]="item.esCombo">
            <span *ngIf="item.esCombo" class="combo-text">Precio especial: </span>
            <span *ngIf="!item.esCombo && tieneMultiplesTamanos(item)" class="price-from">Desde: </span>
            S/ {{ item.precio | number:'1.2-2' }}
          </span>
        </div>
      </mat-card-content>

      <!-- BotÃ³n de acciÃ³n -->
      <div class="card-action-overlay" *ngIf="item.disponible">
        <button mat-mini-fab [color]="item.esCombo ? 'accent' : 'primary'">
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </mat-card>

    <!-- Empty State -->
    <div *ngIf="paginatedItems.length === 0" class="no-results">
      <mat-icon>search_off</mat-icon>
      <p>No encontramos productos con esa bÃºsqueda.</p>
      <button mat-button color="primary" (click)="filtrarPorCategoria(null); terminoBusqueda=''">
        Ver todo el menÃº
      </button>
    </div>
  </div>

  <!-- ðŸ“„ PaginaciÃ³n -->
  <mat-paginator 
    [length]="menuItemsFiltrados.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
    [hidden]="menuItemsFiltrados.length === 0"
    class="custom-paginator">
  </mat-paginator>
</div>